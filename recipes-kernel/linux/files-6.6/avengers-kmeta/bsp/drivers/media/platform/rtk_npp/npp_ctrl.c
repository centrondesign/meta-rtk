// SPDX-License-Identifier: GPL-2.0-only
/*
 * Realtek npu_pp video m2m and capture v4l2 driver
 *
 * Copyright (c) 2024 Realtek Semiconductor Corp.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 */

#include "npp_ctrl.h"
#include "npp_register.h"
#include "npp_common.h"

#define SYS_REG_SOFT_RESET_MMU_SECURE 0x980000BC
#define SYS_REG_CLOCK_ENABLE7 0x9800008C
#define SET_NPP_RESET(x) ((x) << 0)
#define SET_NPP_CLOCK(x) ((x) << 10)
#define SET_DIP_MMU_RESET(x) ((x) << 8)

#define CEIL(a, b) (a/b+(a%b != 0))
#define ABS(x) ((x) >= 0?(x) :  -(x))
#define VO_16P_NUM_COEFF_RATIOS 56

#define DMA_NORMAL_MODE  (2)
#define DMA_PROTECT_MODE (5)
#define FLOAT_TO_FIXED_POINT_UNSIGNED(x, fractional_bits) ((unsigned int)((x) * (1 << (fractional_bits))))
#define FLOAT_TO_FIXED_POINT_SIGNED(x, fractional_bits) ((int)((x) * (1 << (fractional_bits))))

const short VO_coef_2t8p[8] = {
	0x203, 0x2e8,
	0x4a5, 0x6d6,
	0x92a, 0xb5b,
	0xd18, 0xdfd
};

const unsigned int VO_16p_ScaleRatio[VO_16P_NUM_COEFF_RATIOS] = {
	0xffff, 0x11000, 0x12000, 0x13000, 0x14000, 0x15000, 0x16000,
	0x17000, 0x18000, 0x19000, 0x1a000, 0x1b000, 0x1c000, 0x1d000,
	0x1e000, 0x1f000, 0x20000, 0x21000, 0x22000, 0x23000, 0x24000,
	0x25000, 0x26000, 0x27000, 0x28000, 0x29000, 0x2a000, 0x2b000,
	0x2c000, 0x2d000, 0x2e000, 0x2f000, 0x30000, 0x31000, 0x32000,
	0x33000, 0x34000, 0x35000, 0x36000, 0x37000, 0x38000, 0x39000,
	0x3a000, 0x3b000, 0x3c000, 0x3d000, 0x3e000, 0x3f000, 0x48000,
	0x50000, 0x58000, 0x60000, 0x68000, 0x70000, 0x78000, 0x80000};

const short VO_coef_4t16p_ratio[VO_16P_NUM_COEFF_RATIOS][8][4]
= {
// for all upscale ratio
//4taps-- Vertical sampling
{
	{   -4,   256,     8,    -4 },
	{  -12,   252,    24,    -8 },
	{  -20,   244,    40,    -8 },
	{  -26,   234,    58,   -10 },
	{  -28,   220,    78,   -14 },
	{  -28,   202,   100,   -18 },
	{  -28,   184,   122,   -22 },
	{  -26,   164,   142,   -24 },
},
//I=16, D=17, wp= 0.059, ws= 0.065, alpha= 0.100
//4taps-- Vertical sampling
{
	{  -30,   254,   -16,    48 },
	{  -42,   259,     1,    38 },
	{  -53,   261,    22,    26 },
	{  -60,   257,    46,    13 },
	{  -64,   249,    73,    -2 },
	{  -64,   233,   103,   -16 },
	{  -61,   215,   133,   -31 },
	{  -53,   189,   163,   -43 },
},
//I=16, D=18, wp= 0.056, ws= 0.061, alpha= 0.100
//4taps-- Vertical sampling
{
	{  -17,   237,    -3,    39 },
	{  -31,   245,    14,    28 },
	{  -42,   248,    35,    15 },
	{  -52,   249,    58,     1 },
	{  -58,   242,    85,   -13 },
	{  -62,   231,   113,   -26 },
	{  -61,   215,   141,   -39 },
	{  -57,   193,   169,   -49 },
},
//I=16, D=19, wp= 0.053, ws= 0.058, alpha= 0.100
//4taps-- Vertical sampling
{
	{   -6,   226,     9,    27 },
	{  -19,   234,    26,    15 },
	{  -31,   238,    46,     3 },
	{  -42,   239,    69,   -10 },
	{  -50,   235,    94,   -23 },
	{  -55,   225,   120,   -34 },
	{  -58,   212,   146,   -44 },
	{  -56,   193,   171,   -52 },
},
//I=16, D=20, wp= 0.050, ws= 0.055, alpha= 0.100
//4taps-- Vertical sampling
{
	{    6,   217,    20,    13 },
	{   -7,   224,    37,     2 },
	{  -20,   229,    57,   -10 },
	{  -31,   230,    78,   -21 },
	{  -40,   226,   101,   -31 },
	{  -47,   218,   125,   -40 },
	{  -52,   207,   148,   -47 },
	{  -53,   190,   170,   -51 },
},
//I=16, D=21, wp= 0.048, ws= 0.052, alpha= 0.100
//4taps-- Vertical sampling
{
	{   16,   212,    30,    -2 },
	{    3,   217,    47,   -11 },
	{   -9,   220,    66,   -21 },
	{  -20,   220,    86,   -30 },
	{  -30,   216,   107,   -37 },
	{  -38,   209,   128,   -43 },
	{  -44,   198,   149,   -47 },
	{  -48,   185,   168,   -49 },
},
//I=16, D=22, wp= 0.045, ws= 0.050, alpha= 0.100
//4taps-- Vertical sampling
{
	{   26,   205,    40,   -15 },
	{   13,   210,    56,   -23 },
	{    1,   213,    73,   -31 },
	{  -10,   211,    92,   -37 },
	{  -20,   208,   110,   -42 },
	{  -29,   201,   129,   -45 },
	{  -37,   192,   147,   -46 },
	{  -42,   179,   164,   -45 },
},
//I=16, D=23, wp= 0.043, ws= 0.048, alpha= 0.100
//4taps-- Vertical sampling
{
	{   34,   201,    48,   -27 },
	{   22,   204,    63,   -33 },
	{   10,   205,    79,   -38 },
	{   -1,   203,    96,   -42 },
	{  -12,   199,   113,   -44 },
	{  -21,   192,   130,   -45 },
	{  -30,   185,   145,   -44 },
	{  -36,   173,   160,   -41 },
},
//I=16, D=24, wp= 0.042, ws= 0.046, alpha= 0.100
//4taps-- Vertical sampling
{
	{   42,   197,    55,   -38 },
	{   30,   198,    69,   -41 },
	{   18,   198,    84,   -44 },
	{    6,   197,    99,   -46 },
	{   -4,   192,   114,   -46 },
	{  -14,   185,   129,   -44 },
	{  -23,   177,   143,   -41 },
	{  -31,   168,   156,   -37 },
},
//I=16, D=25, wp= 0.040, ws= 0.044, alpha= 0.100
//4taps-- Vertical sampling
{
	{   48,   193,    61,   -46 },
	{   36,   194,    74,   -48 },
	{   24,   193,    88,   -49 },
	{   13,   189,   102,   -48 },
	{    2,   185,   115,   -46 },
	{   -8,   179,   128,   -43 },
	{  -18,   172,   141,   -39 },
	{  -26,   163,   152,   -33 },
},
//I=16, D=26, wp= 0.038, ws= 0.042, alpha= 0.100
//4taps-- Vertical sampling
{
	{   53,   191,    65,   -53 },
	{   41,   190,    78,   -53 },
	{   29,   188,    91,   -52 },
	{   18,   184,   103,   -49 },
	{    7,   180,   115,   -46 },
	{   -3,   173,   127,   -41 },
	{  -13,   167,   138,   -36 },
	{  -21,   157,   149,   -29 },
},
//I=16, D=27, wp= 0.037, ws= 0.041, alpha= 0.100
//4taps-- Vertical sampling
{
	{   57,   188,    69,   -58 },
	{   45,   186,    81,   -56 },
	{   34,   183,    93,   -54 },
	{   22,   180,   104,   -50 },
	{   12,   174,   115,   -45 },
	{    1,   169,   126,   -40 },
	{   -8,   161,   136,   -33 },
	{  -17,   154,   145,   -26 },
},
//I=16, D=28, wp= 0.036, ws= 0.039, alpha= 0.100
//4taps-- Vertical sampling
{
	{   61,   184,    73,   -62 },
	{   49,   182,    84,   -59 },
	{   37,   180,    94,   -55 },
	{   26,   175,   105,   -50 },
	{   15,   170,   115,   -44 },
	{    5,   164,   125,   -38 },
	{   -5,   157,   134,   -30 },
	{  -14,   151,   142,   -23 },
},
//I=16, D=29, wp= 0.034, ws= 0.038, alpha= 0.100
//4taps-- Vertical sampling
{
	{   64,   182,    75,   -65 },
	{   52,   179,    86,   -61 },
	{   41,   174,    96,   -55 },
	{   29,   171,   105,   -49 },
	{   19,   166,   114,   -43 },
	{    8,   161,   123,   -36 },
	{   -2,   154,   132,   -28 },
	{  -11,   147,   140,   -20 },
},
//I=16, D=30, wp= 0.033, ws= 0.037, alpha= 0.100
//4taps-- Vertical sampling
{
	{   67,   178,    78,   -67 },
	{   55,   176,    87,   -62 },
	{   43,   172,    96,   -55 },
	{   32,   168,   105,   -49 },
	{   21,   162,   114,   -41 },
	{   11,   157,   122,   -34 },
	{    1,   151,   130,   -26 },
	{   -8,   144,   137,   -17 },
},
//I=16, D=31, wp= 0.032, ws= 0.035, alpha= 0.100
//4taps-- Vertical sampling
{
	{   69,   177,    79,   -69 },
	{   57,   173,    88,   -62 },
	{   46,   168,    97,   -55 },
	{   35,   164,   105,   -48 },
	{   24,   159,   113,   -40 },
	{   14,   153,   121,   -32 },
	{    4,   147,   128,   -23 },
	{   -6,   142,   135,   -15 },
},
//I=16, D=32, wp= 0.031, ws= 0.034, alpha= 0.100
//4taps-- Vertical sampling
{
	{   70,   174,    81,   -69 },
	{   59,   170,    89,   -62 },
	{   47,   166,    97,   -54 },
	{   37,   160,   105,   -46 },
	{   26,   156,   112,   -38 },
	{   16,   151,   119,   -30 },
	{    6,   145,   126,   -21 },
	{   -3,   138,   133,   -12 },
},
//I=16, D=33, wp= 0.030, ws= 0.033, alpha= 0.100
//4taps-- Vertical sampling
{
	{   72,   172,    82,   -70 },
	{   60,   167,    90,   -61 },
	{   49,   162,    98,   -53 },
	{   38,   158,   105,   -45 },
	{   28,   152,   112,   -36 },
	{   18,   148,   118,   -28 },
	{    8,   142,   125,   -19 },
	{   -1,   136,   131,   -10 },
},
//I=16, D=34, wp= 0.029, ws= 0.032, alpha= 0.100
//4taps-- Vertical sampling
{
	{   73,   169,    83,   -69 },
	{   62,   165,    90,   -61 },
	{   51,   159,    98,   -52 },
	{   40,   155,   104,   -43 },
	{   30,   150,   111,   -35 },
	{   20,   145,   117,   -26 },
	{   10,   140,   123,   -17 },
	{    1,   134,   129,    -8 },
},
//I=16, D=35, wp= 0.029, ws= 0.031, alpha= 0.100
//4taps-- Vertical sampling
{
	{   74,   167,    84,   -69 },
	{   63,   161,    91,   -59 },
	{   52,   157,    97,   -50 },
	{   42,   151,   104,   -41 },
	{   32,   147,   110,   -33 },
	{   22,   142,   116,   -24 },
	{   12,   138,   121,   -15 },
	{    3,   132,   127,    -6 },
},
//I=16, D=36, wp= 0.028, ws= 0.031, alpha= 0.100
//4taps-- Vertical sampling
{
	{   75,   164,    84,   -67 },
	{   64,   159,    91,   -58 },
	{   53,   155,    97,   -49 },
	{   43,   150,   103,   -40 },
	{   33,   145,   109,   -31 },
	{   23,   141,   114,   -22 },
	{   14,   135,   120,   -13 },
	{    5,   130,   125,    -4 },
},
//I=16, D=37, wp= 0.027, ws= 0.030, alpha= 0.100
//4taps-- Vertical sampling
{
	{   76,   161,    85,   -66 },
	{   65,   156,    91,   -56 },
	{   54,   152,    97,   -47 },
	{   44,   147,   103,   -38 },
	{   34,   143,   108,   -29 },
	{   25,   138,   113,   -20 },
	{   16,   133,   118,   -11 },
	{    7,   128,   123,    -2 },
},
//I=16, D=38, wp= 0.026, ws= 0.029, alpha= 0.100
//4taps-- Vertical sampling
{
	{   76,   159,    85,   -64 },
	{   65,   154,    91,   -54 },
	{   55,   149,    97,   -45 },
	{   45,   144,   102,   -35 },
	{   36,   139,   107,   -26 },
	{   27,   135,   112,   -18 },
	{   18,   130,   117,    -9 },
	{    9,   126,   121,     0 },
},
//I=16, D=39, wp= 0.026, ws= 0.028, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   156,    85,   -62 },
	{   66,   151,    91,   -52 },
	{   56,   147,    96,   -43 },
	{   46,   142,   101,   -33 },
	{   37,   137,   106,   -24 },
	{   28,   133,   111,   -16 },
	{   19,   129,   115,    -7 },
	{   10,   124,   120,     2 },
},
//I=16, D=40, wp= 0.025, ws= 0.028, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   154,    85,   -60 },
	{   67,   149,    90,   -50 },
	{   57,   144,    95,   -40 },
	{   47,   140,   100,   -31 },
	{   38,   135,   105,   -22 },
	{   29,   131,   109,   -13 },
	{   21,   126,   114,    -5 },
	{   12,   122,   118,     4 },
},
//I=16, D=41, wp= 0.024, ws= 0.027, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   151,    85,   -57 },
	{   67,   146,    90,   -47 },
	{   57,   142,    95,   -38 },
	{   48,   138,    99,   -29 },
	{   39,   133,   104,   -20 },
	{   31,   128,   108,   -11 },
	{   22,   125,   112,    -3 },
	{   14,   121,   116,     5 },
},
//I=16, D=42, wp= 0.024, ws= 0.026, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   149,    85,   -55 },
	{   67,   144,    90,   -45 },
	{   58,   139,    94,   -35 },
	{   49,   134,    99,   -26 },
	{   40,   131,   103,   -18 },
	{   32,   126,   107,    -9 },
	{   24,   122,   111,    -1 },
	{   15,   119,   115,     7 },
},
//I=16, D=43, wp= 0.023, ws= 0.026, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   146,    85,   -52 },
	{   68,   141,    89,   -42 },
	{   59,   136,    94,   -33 },
	{   50,   132,    98,   -24 },
	{   41,   128,   102,   -15 },
	{   33,   125,   105,    -7 },
	{   25,   121,   109,     1 },
	{   17,   117,   113,     9 },
},
//I=16, D=44, wp= 0.023, ws= 0.025, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   144,    84,   -49 },
	{   68,   138,    89,   -39 },
	{   59,   134,    93,   -30 },
	{   51,   129,    97,   -21 },
	{   42,   127,   100,   -13 },
	{   34,   123,   104,    -5 },
	{   26,   119,   108,     3 },
	{   19,   115,   111,    11 },
},
//I=16, D=45, wp= 0.022, ws= 0.024, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   140,    84,   -45 },
	{   68,   136,    88,   -36 },
	{   60,   131,    92,   -27 },
	{   51,   128,    96,   -19 },
	{   43,   124,    99,   -10 },
	{   36,   120,   103,    -3 },
	{   28,   117,   106,     5 },
	{   20,   113,   110,    13 },
},
//I=16, D=46, wp= 0.022, ws= 0.024, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   137,    84,   -42 },
	{   68,   133,    88,   -33 },
	{   60,   129,    91,   -24 },
	{   52,   125,    95,   -16 },
	{   44,   122,    98,    -8 },
	{   37,   117,   102,     0 },
	{   29,   115,   105,     7 },
	{   22,   111,   108,    15 },
},
//I=16, D=47, wp= 0.021, ws= 0.023, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   135,    83,   -39 },
	{   68,   131,    87,   -30 },
	{   60,   127,    90,   -21 },
	{   53,   122,    94,   -13 },
	{   45,   120,    97,    -6 },
	{   38,   116,   100,     2 },
	{   31,   113,   103,     9 },
	{   23,   110,   107,    16 },
},
//I=16, D=48, wp= 0.021, ws= 0.023, alpha= 0.100
//4taps-- Vertical sampling
{
	{   77,   131,    83,   -35 },
	{   69,   128,    86,   -27 },
	{   61,   123,    90,   -18 },
	{   53,   121,    93,   -11 },
	{   46,   117,    96,    -3 },
	{   39,   114,    99,     4 },
	{   32,   111,   102,    11 },
	{   25,   108,   105,    18 },
},
//I=16, D=49, wp= 0.020, ws= 0.022, alpha= 0.100
//4taps-- Vertical sampling
{
	{   76,   130,    82,   -32 },
	{   69,   124,    86,   -23 },
	{   61,   122,    89,   -16 },
	{   54,   118,    92,    -8 },
	{   47,   115,    95,    -1 },
	{   40,   112,    98,     6 },
	{   33,   109,   101,    13 },
	{   26,   107,   103,    20 },
},
//I=16, D=50, wp= 0.020, ws= 0.022, alpha= 0.100
//4taps-- Vertical sampling
{
	{   76,   126,    82,   -28 },
	{   69,   122,    85,   -20 },
	{   61,   120,    88,   -13 },
	{   54,   116,    91,    -5 },
	{   48,   112,    94,     2 },
	{   41,   111,    96,     8 },
	{   34,   108,    99,    15 },
	{   28,   104,   102,    22 },
},
//I=16, D=51, wp= 0.020, ws= 0.022, alpha= 0.100
//4taps-- Vertical sampling
{
	{   76,   124,    81,   -25 },
	{   69,   120,    84,   -17 },
	{   62,   117,    87,   -10 },
	{   55,   114,    90,    -3 },
	{   48,   112,    92,     4 },
	{   42,   108,    95,    11 },
	{   36,   105,    98,    17 },
	{   29,   104,   100,    23 },
},
//I=16, D=52, wp= 0.019, ws= 0.021, alpha= 0.100
//4taps-- Vertical sampling
{
	{   76,   120,    81,   -21 },
	{   69,   118,    83,   -14 },
	{   62,   115,    86,    -7 },
	{   55,   112,    89,     0 },
	{   49,   110,    91,     6 },
	{   43,   106,    94,    13 },
	{   37,   104,    96,    19 },
	{   31,   101,    99,    25 },
},
//I=16, D=53, wp= 0.019, ws= 0.021, alpha= 0.100
//4taps-- Vertical sampling
{
	{   75,   119,    80,   -18 },
	{   68,   116,    83,   -11 },
	{   62,   113,    85,    -4 },
	{   56,   110,    88,     2 },
	{   50,   107,    90,     9 },
	{   44,   104,    93,    15 },
	{   38,   102,    95,    21 },
	{   32,   101,    97,    26 },
},
//I=16, D=54, wp= 0.019, ws= 0.020, alpha= 0.100
//4taps-- Vertical sampling
{
	{   75,   117,    79,   -15 },
	{   68,   114,    82,    -8 },
	{   62,   111,    84,    -1 },
	{   56,   108,    87,     5 },
	{   50,   106,    89,    11 },
	{   45,   103,    91,    17 },
	{   39,   101,    94,    22 },
	{   34,    98,    96,    28 },
},
//I=16, D=55, wp= 0.018, ws= 0.020, alpha= 0.100
//4taps-- Vertical sampling
{
	{   74,   114,    79,   -11 },
	{   68,   112,    81,    -5 },
	{   62,   109,    84,     1 },
	{   57,   106,    86,     7 },
	{   51,   104,    88,    13 },
	{   46,   101,    90,    19 },
	{   40,   100,    92,    24 },
	{   35,    96,    95,    30 },
},
//I=16, D=56, wp= 0.018, ws= 0.020, alpha= 0.100
//4taps-- Vertical sampling
{
	{   74,   112,    78,    -8 },
	{   68,   109,    81,    -2 },
	{   63,   106,    83,     4 },
	{   57,   104,    85,    10 },
	{   52,   102,    87,    15 },
	{   47,    99,    89,    21 },
	{   41,    98,    91,    26 },
	{   36,    96,    93,    31 },
},
//I=16, D=57, wp= 0.018, ws= 0.019, alpha= 0.100
//4taps-- Vertical sampling
{
	{   74,   109,    78,    -5 },
	{   68,   107,    80,     1 },
	{   63,   104,    82,     7 },
	{   57,   103,    84,    12 },
	{   52,   101,    86,    17 },
	{   47,    99,    88,    22 },
	{   42,    96,    90,    28 },
	{   37,    94,    92,    33 },
},
//I=16, D=58, wp= 0.017, ws= 0.019, alpha= 0.100
//4taps-- Vertical sampling
{
	{   73,   108,    77,    -2 },
	{   68,   105,    79,     4 },
	{   63,   103,    81,     9 },
	{   58,   101,    83,    14 },
	{   53,    99,    85,    19 },
	{   48,    97,    87,    24 },
	{   43,    95,    89,    29 },
	{   39,    92,    91,    34 },
},
//I=16, D=59, wp= 0.017, ws= 0.019, alpha= 0.100
//4taps-- Vertical sampling
{
	{   73,   105,    77,     1 },
	{   68,   103,    79,     6 },
	{   63,   100,    81,    12 },
	{   58,    99,    82,    17 },
	{   53,    98,    84,    21 },
	{   49,    95,    86,    26 },
	{   44,    93,    88,    31 },
	{   40,    91,    90,    35 },
},
//I=16, D=60, wp= 0.017, ws= 0.018, alpha= 0.100
//4taps-- Vertical sampling
{
	{   73,   103,    76,     4 },
	{   68,   101,    78,     9 },
	{   63,    99,    80,    14 },
	{   58,    97,    82,    19 },
	{   54,    96,    83,    23 },
	{   50,    93,    85,    28 },
	{   45,    92,    87,    32 },
	{   41,    90,    88,    37 },
},
//I=16, D=61, wp= 0.016, ws= 0.018, alpha= 0.100
//4taps-- Vertical sampling
{
	{   72,   101,    76,     7 },
	{   68,   100,    77,    11 },
	{   63,    98,    79,    16 },
	{   59,    95,    81,    21 },
	{   54,    95,    82,    25 },
	{   50,    93,    84,    29 },
	{   46,    90,    86,    34 },
	{   42,    89,    87,    38 },
},
//I=16, D=62, wp= 0.016, ws= 0.018, alpha= 0.100
//4taps-- Vertical sampling
{
	{   72,   100,    75,     9 },
	{   68,    97,    77,    14 },
	{   63,    97,    78,    18 },
	{   59,    94,    80,    23 },
	{   55,    92,    82,    27 },
	{   51,    91,    83,    31 },
	{   47,    89,    85,    35 },
	{   43,    88,    86,    39 },
},
//I=16, D=63, wp= 0.016, ws= 0.017, alpha= 0.100
//4taps-- Vertical sampling
{
	{   72,    97,    75,    12 },
	{   67,    97,    76,    16 },
	{   63,    95,    78,    20 },
	{   59,    94,    79,    24 },
	{   55,    92,    81,    28 },
	{   52,    90,    82,    32 },
	{   48,    88,    84,    36 },
	{   44,    87,    85,    40 },
},
//I=16, D=72, wp= 0.014, ws= 0.015, alpha= 0.100
//4taps-- Vertical sampling
{
	{   69,    87,    71,    29 },
	{   67,    85,    72,    32 },
	{   64,    84,    73,    35 },
	{   61,    84,    74,    37 },
	{   58,    83,    75,    40 },
	{   56,    81,    76,    43 },
	{   53,    81,    77,    45 },
	{   51,    79,    78,    48 },
},
//I=16, D=80, wp= 0.013, ws= 0.014, alpha= 0.100
//4taps-- Vertical sampling
{
	{   68,    80,    69,    39 },
	{   66,    79,    70,    41 },
	{   64,    78,    71,    43 },
	{   62,    77,    72,    45 },
	{   60,    77,    72,    47 },
	{   58,    77,    73,    48 },
	{   56,    76,    74,    50 },
	{   54,    76,    74,    52 },
},
//I=16, D=88, wp= 0.011, ws= 0.013, alpha= 0.100
//4taps-- Vertical sampling
{
	{   67,    76,    68,    45 },
	{   65,    76,    69,    46 },
	{   64,    75,    69,    48 },
	{   63,    74,    70,    49 },
	{   61,    74,    70,    51 },
	{   60,    73,    71,    52 },
	{   58,    73,    71,    54 },
	{   57,    72,    72,    55 },
},
//I=16, D=96, wp= 0.010, ws= 0.011, alpha= 0.100
//4taps-- Vertical sampling
{
	{   66,    74,    67,    49 },
	{   65,    73,    68,    50 },
	{   64,    72,    68,    52 },
	{   63,    72,    68,    53 },
	{   62,    71,    69,    54 },
	{   61,    71,    69,    55 },
	{   59,    71,    70,    56 },
	{   58,    71,    70,    57 },
},
//I=16, D=104, wp= 0.010, ws= 0.011, alpha= 0.100
//4taps-- Vertical sampling
{
	{   66,    71,    67,    52 },
	{   65,    71,    67,    53 },
	{   64,    71,    67,    54 },
	{   63,    70,    68,    55 },
	{   62,    70,    68,    56 },
	{   61,    70,    68,    57 },
	{   60,    70,    68,    58 },
	{   60,    68,    69,    59 },
},
//I=16, D=112, wp= 0.009, ws= 0.010, alpha= 0.100
//4taps-- Vertical sampling
{
	{   66,    70,    66,    54 },
	{   65,    70,    66,    55 },
	{   64,    69,    67,    56 },
	{   63,    69,    67,    57 },
	{   63,    69,    67,    57 },
	{   62,    69,    67,    58 },
	{   61,    68,    68,    59 },
	{   60,    68,    68,    60 },
},
//I=16, D=120, wp= 0.008, ws= 0.009, alpha= 0.100
//4taps-- Vertical sampling
{
	{   65,    69,    66,    56 },
	{   65,    68,    66,    57 },
	{   64,    69,    66,    57 },
	{   63,    69,    66,    58 },
	{   63,    67,    67,    59 },
	{   62,    68,    67,    59 },
	{   62,    67,    67,    60 },
	{   61,    68,    67,    60 },
},
//I=16, D=128, wp= 0.008, ws= 0.009, alpha= 0.100
//4taps-- Vertical sampling
{
	{   65,    69,    65,    57 },
	{   65,    67,    66,    58 },
	{   64,    68,    66,    58 },
	{   64,    67,    66,    59 },
	{   63,    68,    66,    59 },
	{   62,    68,    66,    60 },
	{   62,    67,    67,    60 },
	{   61,    67,    67,    61 },
},
};

const short VO_coef_8t16p_ratio[VO_16P_NUM_COEFF_RATIOS][8][8]
= {
// for all upscale ratio
//8taps-- Horizontal sampling
{
	{    0,     0,    -4,   256,     8,    -4,     0,     0 },
	{    0,     0,   -12,   252,    24,    -8,     0,     0 },
	{    0,     0,   -20,   244,    40,    -8,     0,     0 },
	{    0,     0,   -26,   234,    58,   -10,     0,     0 },
	{    0,     0,   -28,   220,    78,   -14,     0,     0 },
	{    0,     0,   -28,   202,   100,   -18,     0,     0 },
	{    0,     0,   -28,   184,   122,   -22,     0,     0 },
	{    0,     0,   -26,   164,   142,   -24,     0,     0 },
},

//I=16, D=17, wp= 0.059, ws= 0.065, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -13,    12,   -15,   252,     0,     5,    -8,    23 },
	{  -17,    19,   -28,   252,    18,    -3,    -3,    18 },
	{  -20,    25,   -39,   248,    38,   -12,     3,    13 },
	{  -23,    29,   -48,   243,    60,   -21,     9,     7 },
	{  -24,    32,   -54,   233,    84,   -30,    15,     0 },
	{  -24,    34,   -58,   220,   108,   -39,    20,    -5 },
	{  -22,    34,   -58,   200,   133,   -46,    26,   -11 },
	{  -19,    33,   -57,   180,   158,   -53,    30,   -16 },
},
//I=16, D=18, wp= 0.056, ws= 0.061, alpha= 0.100
//8taps-- Horizontal sampling
{
	{    0,     0,    -1,   234,    14,    -8,     5,    12 },
	{   -5,     7,   -15,   238,    31,   -16,    10,     6 },
	{  -10,    13,   -27,   239,    50,   -24,    15,     0 },
	{  -14,    20,   -37,   233,    71,   -32,    20,    -5 },
	{  -17,    25,   -45,   223,    94,   -39,    25,   -10 },
	{  -20,    29,   -51,   215,   116,   -46,    28,   -15 },
	{  -21,    31,   -54,   199,   139,   -51,    31,   -18 },
	{  -21,    33,   -55,   179,   161,   -54,    33,   -20 },
},
//I=16, D=19, wp= 0.053, ws= 0.058, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   12,   -12,    12,   225,    26,   -19,    16,    -4 },
	{    7,    -6,    -2,   228,    43,   -26,    20,    -8 },
	{    3,     1,   -14,   226,    61,   -33,    24,   -12 },
	{   -2,     8,   -25,   221,    81,   -39,    27,   -15 },
	{   -6,    14,   -34,   214,   100,   -44,    29,   -17 },
	{  -10,    19,   -42,   204,   121,   -48,    30,   -18 },
	{  -13,    23,   -47,   193,   140,   -51,    30,   -19 },
	{  -16,    27,   -50,   177,   159,   -52,    29,   -18 },
},
//I=16, D=20, wp= 0.050, ws= 0.055, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   21,   -23,    23,   222,    37,   -29,    23,   -18 },
	{   17,   -17,     9,   221,    53,   -34,    26,   -19 },
	{   13,   -10,    -3,   217,    70,   -39,    28,   -20 },
	{    9,    -4,   -15,   214,    87,   -43,    28,   -20 },
	{    5,     3,   -24,   204,   105,   -46,    28,   -19 },
	{    0,     8,   -33,   197,   122,   -48,    27,   -17 },
	{   -4,    14,   -39,   184,   139,   -48,    25,   -15 },
	{   -8,    19,   -44,   171,   155,   -47,    22,   -12 },
},
//I=16, D=21, wp= 0.048, ws= 0.052, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   26,   -31,    32,   218,    46,   -36,    27,   -26 },
	{   23,   -25,    18,   216,    61,   -40,    28,   -25 },
	{   20,   -19,     6,   210,    77,   -43,    28,   -23 },
	{   17,   -13,    -6,   204,    92,   -45,    27,   -20 },
	{   13,    -7,   -16,   197,   107,   -46,    25,   -17 },
	{    9,    -1,   -24,   186,   123,   -46,    22,   -13 },
	{    4,     5,   -32,   177,   137,   -45,    19,    -9 },
	{    0,    10,   -37,   164,   151,   -42,    15,    -5 },
},
//I=16, D=22, wp= 0.045, ws= 0.050, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   27,   -37,    40,   214,    54,   -41,    28,   -29 },
	{   26,   -32,    26,   209,    68,   -43,    27,   -25 },
	{   24,   -27,    14,   204,    82,   -45,    25,   -21 },
	{   22,   -21,     2,   198,    95,   -45,    22,   -17 },
	{   19,   -15,    -8,   189,   109,   -45,    19,   -12 },
	{   15,   -10,   -17,   180,   122,   -43,    16,    -7 },
	{   11,    -4,   -25,   171,   135,   -40,    11,    -3 },
	{    7,     2,   -31,   158,   147,   -36,     7,     2 },
},
//I=16, D=23, wp= 0.043, ws= 0.048, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   26,   -41,    47,   208,    61,   -43,    25,   -27 },
	{   26,   -37,    34,   203,    73,   -44,    23,   -22 },
	{   25,   -32,    21,   196,    86,   -44,    20,   -16 },
	{   24,   -27,    10,   189,    98,   -44,    17,   -11 },
	{   22,   -22,     0,   181,   110,   -42,    13,    -6 },
	{   19,   -17,   -10,   174,   122,   -39,     8,    -1 },
	{   16,   -11,   -18,   163,   133,   -35,     4,     4 },
	{   12,    -6,   -25,   154,   144,   -30,    -1,     8 },
},
//I=16, D=24, wp= 0.042, ws= 0.046, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   22,   -42,    54,   200,    66,   -44,    20,   -20 },
	{   23,   -39,    40,   196,    78,   -44,    17,   -15 },
	{   23,   -36,    28,   191,    89,   -43,    13,    -9 },
	{   23,   -32,    17,   184,   100,   -41,     9,    -4 },
	{   22,   -27,     7,   175,   111,   -38,     5,     1 },
	{   21,   -23,    -2,   167,   121,   -34,     1,     5 },
	{   19,   -18,   -11,   160,   131,   -30,    -4,     9 },
	{   16,   -13,   -18,   150,   141,   -24,    -9,    13 },
},
//I=16, D=25, wp= 0.040, ws= 0.044, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   16,   -42,    59,   193,    71,   -43,    13,   -11 },
	{   18,   -40,    46,   188,    81,   -41,    10,    -6 },
	{   20,   -38,    35,   182,    91,   -39,     6,    -1 },
	{   21,   -35,    24,   177,   101,   -37,     2,     3 },
	{   21,   -31,    14,   169,   111,   -33,    -2,     7 },
	{   21,   -28,     5,   163,   120,   -29,    -7,    11 },
	{   20,   -24,    -3,   153,   130,   -23,   -11,    14 },
	{   18,   -20,   -11,   148,   138,   -18,   -15,    16 },
},
//I=16, D=26, wp= 0.038, ws= 0.042, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   10,   -41,    63,   185,    74,   -40,     6,    -1 },
	{   13,   -40,    52,   179,    84,   -38,     3,     3 },
	{   15,   -38,    41,   174,    93,   -35,    -1,     7 },
	{   17,   -37,    30,   171,   102,   -32,    -5,    10 },
	{   18,   -34,    21,   164,   111,   -28,    -9,    13 },
	{   19,   -31,    12,   157,   120,   -23,   -13,    15 },
	{   19,   -28,     3,   151,   128,   -17,   -17,    17 },
	{   19,   -25,    -4,   144,   136,   -11,   -21,    18 },
},
//I=16, D=27, wp= 0.037, ws= 0.041, alpha= 0.100
//8taps-- Horizontal sampling
{
	{    3,   -38,    67,   174,    77,   -36,     0,     9 },
	{    7,   -38,    56,   172,    86,   -34,    -4,    11 },
	{   10,   -38,    46,   167,    95,   -30,    -8,    14 },
	{   12,   -37,    36,   165,   103,   -27,   -12,    16 },
	{   14,   -36,    27,   160,   111,   -22,   -15,    17 },
	{   16,   -34,    18,   155,   119,   -17,   -19,    18 },
	{   17,   -31,    10,   147,   127,   -11,   -22,    19 },
	{   18,   -29,     2,   143,   134,    -5,   -26,    19 },
},
//I=16, D=28, wp= 0.036, ws= 0.039, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -2,   -35,    69,   168,    79,   -33,    -6,    16 },
	{    1,   -36,    60,   165,    87,   -29,   -10,    18 },
	{    5,   -36,    50,   161,    96,   -26,   -13,    19 },
	{    8,   -36,    41,   158,   104,   -22,   -17,    20 },
	{   10,   -36,    32,   156,   111,   -17,   -20,    20 },
	{   13,   -35,    24,   149,   119,   -11,   -23,    20 },
	{   15,   -33,    16,   144,   126,    -5,   -26,    19 },
	{   17,   -31,     8,   139,   133,     1,   -29,    18 },
},
//I=16, D=29, wp= 0.034, ws= 0.038, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -7,   -31,    71,   161,    80,   -29,   -11,    22 },
	{   -4,   -33,    62,   160,    88,   -25,   -14,    22 },
	{    0,   -35,    54,   158,    96,   -21,   -18,    22 },
	{    3,   -35,    45,   155,   104,   -17,   -21,    22 },
	{    7,   -35,    37,   151,   111,   -12,   -24,    21 },
	{   10,   -35,    29,   147,   118,    -6,   -27,    20 },
	{   12,   -34,    21,   142,   125,     0,   -29,    19 },
	{   15,   -33,    14,   136,   131,     7,   -31,    17 },
},
//I=16, D=30, wp= 0.033, ws= 0.037, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -11,   -28,    73,   155,    81,   -25,   -15,    26 },
	{   -8,   -30,    65,   154,    89,   -21,   -18,    25 },
	{   -4,   -32,    57,   152,    97,   -17,   -21,    24 },
	{   -1,   -34,    49,   151,   104,   -12,   -24,    23 },
	{    3,   -34,    41,   147,   111,    -7,   -27,    22 },
	{    6,   -35,    33,   144,   118,    -1,   -29,    20 },
	{    9,   -34,    26,   140,   124,     5,   -31,    17 },
	{   12,   -34,    18,   137,   130,    11,   -33,    15 },
},
//I=16, D=31, wp= 0.032, ws= 0.035, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -14,   -24,    74,   149,    82,   -21,   -18,    28 },
	{  -11,   -27,    67,   149,    89,   -17,   -21,    27 },
	{   -8,   -30,    59,   150,    97,   -13,   -24,    25 },
	{   -4,   -32,    52,   147,   104,    -8,   -26,    23 },
	{   -1,   -33,    44,   145,   111,    -3,   -28,    21 },
	{    3,   -34,    37,   142,   117,     3,   -30,    18 },
	{    6,   -34,    30,   138,   123,     9,   -32,    16 },
	{   10,   -34,    23,   132,   129,    16,   -33,    13 },
},
//I=16, D=32, wp= 0.031, ws= 0.034, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -17,   -21,    75,   145,    82,   -17,   -20,    29 },
	{  -14,   -24,    68,   145,    90,   -13,   -23,    27 },
	{  -11,   -27,    62,   144,    97,    -9,   -25,    25 },
	{   -7,   -29,    54,   144,   104,    -4,   -28,    22 },
	{   -4,   -31,    47,   143,   110,     1,   -30,    20 },
	{    0,   -32,    40,   138,   117,     7,   -31,    17 },
	{    3,   -33,    33,   136,   122,    13,   -32,    14 },
	{    7,   -33,    26,   132,   127,    20,   -33,    10 },
},
//I=16, D=33, wp= 0.030, ws= 0.033, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -19,   -18,    76,   141,    83,   -14,   -22,    29 },
	{  -16,   -21,    70,   141,    90,   -10,   -24,    26 },
	{  -13,   -24,    63,   141,    97,    -5,   -27,    24 },
	{  -10,   -27,    57,   141,   103,     0,   -29,    21 },
	{   -7,   -29,    50,   139,   110,     5,   -30,    18 },
	{   -3,   -31,    43,   137,   116,    11,   -31,    14 },
	{    0,   -32,    36,   135,   121,    17,   -32,    11 },
	{    4,   -32,    30,   131,   126,    23,   -33,     7 },
},
//I=16, D=34, wp= 0.029, ws= 0.032, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -21,   -14,    77,   137,    83,   -10,   -23,    27 },
	{  -18,   -18,    71,   137,    90,    -6,   -25,    25 },
	{  -16,   -21,    65,   139,    96,    -2,   -27,    22 },
	{  -13,   -24,    59,   138,   103,     3,   -29,    19 },
	{  -10,   -26,    52,   137,   109,     9,   -30,    15 },
	{   -6,   -28,    46,   134,   115,    14,   -31,    12 },
	{   -3,   -30,    39,   134,   120,    20,   -32,     8 },
	{    1,   -31,    33,   127,   125,    27,   -31,     5 },
},
//I=16, D=35, wp= 0.029, ws= 0.031, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -22,   -11,    77,   134,    83,    -7,   -24,    26 },
	{  -20,   -15,    72,   135,    90,    -3,   -26,    23 },
	{  -18,   -18,    66,   137,    96,     2,   -28,    19 },
	{  -15,   -21,    61,   135,   102,     7,   -29,    16 },
	{  -12,   -24,    55,   134,   108,    12,   -30,    13 },
	{   -9,   -26,    48,   132,   114,    18,   -30,     9 },
	{   -5,   -28,    42,   129,   119,    24,   -30,     5 },
	{   -2,   -29,    36,   126,   123,    30,   -30,     2 },
},
//I=16, D=36, wp= 0.028, ws= 0.031, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -23,    -8,    78,   132,    83,    -4,   -25,    23 },
	{  -21,   -12,    73,   133,    89,     0,   -26,    20 },
	{  -19,   -15,    68,   132,    96,     5,   -28,    17 },
	{  -17,   -18,    62,   132,   102,    10,   -28,    13 },
	{  -14,   -21,    56,   132,   107,    15,   -29,    10 },
	{  -11,   -23,    51,   129,   112,    21,   -29,     6 },
	{   -8,   -25,    45,   127,   117,    27,   -29,     2 },
	{   -5,   -27,    39,   124,   121,    33,   -28,    -1 },
},
//I=16, D=37, wp= 0.027, ws= 0.030, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -23,    -4,    78,   127,    83,     0,   -25,    20 },
	{  -22,    -8,    73,   129,    89,     4,   -26,    17 },
	{  -20,   -12,    69,   130,    95,     8,   -27,    13 },
	{  -18,   -15,    63,   130,   101,    13,   -28,    10 },
	{  -16,   -18,    58,   129,   106,    19,   -28,     6 },
	{  -13,   -21,    53,   127,   111,    24,   -28,     3 },
	{  -10,   -23,    47,   125,   115,    30,   -27,    -1 },
	{   -7,   -25,    41,   123,   119,    35,   -26,    -4 },
},
//I=16, D=38, wp= 0.026, ws= 0.029, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -24,    -1,    78,   126,    83,     3,   -25,    16 },
	{  -23,    -5,    74,   127,    89,     7,   -26,    13 },
	{  -21,    -9,    69,   127,    94,    12,   -26,    10 },
	{  -19,   -12,    65,   126,   100,    17,   -27,     6 },
	{  -17,   -15,    60,   124,   105,    22,   -26,     3 },
	{  -15,   -18,    54,   125,   109,    27,   -26,     0 },
	{  -13,   -20,    49,   123,   114,    32,   -25,    -4 },
	{  -10,   -22,    43,   121,   117,    38,   -24,    -7 },
},
//I=16, D=39, wp= 0.026, ws= 0.028, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -24,     2,    78,   122,    83,     6,   -24,    13 },
	{  -23,    -2,    74,   125,    88,    10,   -25,     9 },
	{  -22,    -5,    70,   123,    94,    15,   -25,     6 },
	{  -20,    -9,    66,   123,    99,    19,   -25,     3 },
	{  -19,   -12,    61,   124,   103,    24,   -25,     0 },
	{  -17,   -15,    56,   122,   108,    30,   -24,    -4 },
	{  -15,   -17,    51,   120,   112,    35,   -23,    -7 },
	{  -12,   -20,    45,   118,   115,    40,   -21,    -9 },
},
//I=16, D=40, wp= 0.025, ws= 0.028, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -23,     5,    78,   120,    83,     9,   -24,     8 },
	{  -23,     1,    75,   121,    88,    13,   -24,     5 },
	{  -22,    -2,    71,   120,    93,    18,   -24,     2 },
	{  -21,    -6,    66,   122,    98,    22,   -24,    -1 },
	{  -20,    -9,    62,   121,   102,    27,   -23,    -4 },
	{  -18,   -12,    57,   120,   106,    32,   -22,    -7 },
	{  -16,   -14,    52,   117,   110,    37,   -21,    -9 },
	{  -14,   -17,    47,   116,   113,    42,   -19,   -12 },
},
//I=16, D=41, wp= 0.024, ws= 0.027, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -23,     8,    78,   118,    82,    12,   -23,     4 },
	{  -23,     4,    75,   118,    87,    16,   -23,     2 },
	{  -22,     1,    71,   118,    92,    20,   -23,    -1 },
	{  -22,    -3,    67,   119,    96,    25,   -22,    -4 },
	{  -21,    -6,    63,   118,   100,    30,   -21,    -7 },
	{  -19,    -9,    58,   117,   104,    34,   -20,    -9 },
	{  -18,   -12,    54,   115,   108,    39,   -18,   -12 },
	{  -16,   -14,    49,   112,   111,    44,   -16,   -14 },
},
//I=16, D=42, wp= 0.024, ws= 0.026, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -22,    11,    78,   115,    82,    14,   -22,     0 },
	{  -22,     7,    75,   114,    87,    19,   -22,    -2 },
	{  -22,     4,    71,   115,    91,    23,   -21,    -5 },
	{  -22,     0,    68,   115,    95,    27,   -20,    -7 },
	{  -21,    -3,    64,   114,    99,    32,   -19,   -10 },
	{  -20,    -6,    59,   115,   102,    36,   -18,   -12 },
	{  -19,    -9,    55,   112,   106,    41,   -16,   -14 },
	{  -18,   -11,    50,   111,   108,    46,   -14,   -16 },
},
//I=16, D=43, wp= 0.023, ws= 0.026, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -21,    13,    78,   111,    82,    17,   -21,    -3 },
	{  -22,    10,    75,   112,    86,    21,   -20,    -6 },
	{  -22,     6,    72,   113,    90,    25,   -20,    -8 },
	{  -22,     3,    68,   112,    94,    29,   -18,   -10 },
	{  -22,     0,    64,   113,    97,    34,   -17,   -13 },
	{  -21,    -3,    60,   110,   101,    38,   -15,   -14 },
	{  -20,    -6,    56,   109,   104,    43,   -14,   -16 },
	{  -19,    -9,    52,   108,   106,    47,   -11,   -18 },
},
//I=16, D=44, wp= 0.023, ws= 0.025, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -21,    16,    78,   110,    81,    19,   -20,    -7 },
	{  -21,    12,    75,   110,    85,    23,   -19,    -9 },
	{  -22,     9,    72,   110,    89,    27,   -18,   -11 },
	{  -22,     5,    68,   111,    93,    31,   -17,   -13 },
	{  -22,     2,    64,   110,    96,    36,   -15,   -15 },
	{  -22,    -1,    61,   109,    99,    40,   -13,   -17 },
	{  -21,    -4,    57,   107,   102,    44,   -11,   -18 },
	{  -20,    -6,    53,   105,   104,    48,    -9,   -19 },
},
//I=16, D=45, wp= 0.022, ws= 0.024, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -20,    18,    78,   107,    81,    21,   -19,   -10 },
	{  -21,    14,    75,   109,    84,    25,   -18,   -12 },
	{  -21,    11,    72,   108,    88,    29,   -17,   -14 },
	{  -22,     8,    68,   109,    91,    33,   -15,   -16 },
	{  -22,     5,    65,   107,    94,    37,   -13,   -17 },
	{  -22,     2,    61,   106,    97,    41,   -11,   -18 },
	{  -22,    -1,    57,   106,   100,    45,    -9,   -20 },
	{  -21,    -4,    53,   105,   102,    49,    -7,   -21 },
},
//I=16, D=46, wp= 0.022, ws= 0.024, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -19,    20,    77,   107,    80,    23,   -18,   -14 },
	{  -20,    16,    74,   106,    84,    27,   -16,   -15 },
	{  -21,    13,    71,   107,    87,    31,   -15,   -17 },
	{  -21,    10,    68,   105,    90,    35,   -13,   -18 },
	{  -22,     7,    65,   104,    93,    39,   -11,   -19 },
	{  -22,     4,    61,   103,    96,    43,    -9,   -20 },
	{  -22,     1,    58,   103,    98,    46,    -7,   -21 },
	{  -22,    -2,    54,   103,   100,    50,    -5,   -22 },
},
//I=16, D=47, wp= 0.021, ws= 0.023, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -18,    22,    77,   103,    80,    25,   -17,   -16 },
	{  -19,    18,    74,   104,    83,    29,   -15,   -18 },
	{  -20,    15,    71,   105,    86,    32,   -14,   -19 },
	{  -21,    12,    68,   104,    89,    36,   -12,   -20 },
	{  -22,     9,    65,   103,    92,    40,   -10,   -21 },
	{  -22,     6,    62,   102,    94,    44,    -8,   -22 },
	{  -22,     3,    58,   101,    96,    47,    -5,   -22 },
	{  -23,     0,    55,   100,    98,    51,    -3,   -22 },
},
//I=16, D=48, wp= 0.021, ws= 0.023, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -17,    23,    76,   103,    79,    27,   -16,   -19 },
	{  -18,    20,    74,   102,    82,    30,   -14,   -20 },
	{  -20,    17,    71,   102,    85,    34,   -12,   -21 },
	{  -21,    14,    68,   102,    88,    37,   -10,   -22 },
	{  -21,    11,    65,   100,    90,    41,    -8,   -22 },
	{  -22,     8,    62,   100,    92,    45,    -6,   -23 },
	{  -23,     5,    59,    98,    95,    48,    -3,   -23 },
	{  -23,     2,    55,    98,    96,    52,    -1,   -23 },
},
//I=16, D=49, wp= 0.020, ws= 0.022, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -16,    25,    76,   100,    79,    28,   -15,   -21 },
	{  -18,    22,    74,   100,    82,    31,   -13,   -22 },
	{  -19,    18,    71,   101,    84,    35,   -11,   -23 },
	{  -20,    15,    68,   100,    87,    38,    -9,   -23 },
	{  -21,    12,    65,    99,    89,    42,    -7,   -23 },
	{  -22,     9,    62,    99,    91,    45,    -4,   -24 },
	{  -23,     6,    59,    98,    93,    49,    -2,   -24 },
	{  -23,     3,    56,    96,    95,    52,     1,   -24 },
},
//I=16, D=50, wp= 0.020, ws= 0.022, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -15,    26,    76,    99,    78,    29,   -14,   -23 },
	{  -17,    23,    73,    99,    81,    33,   -12,   -24 },
	{  -18,    20,    71,    98,    83,    36,   -10,   -24 },
	{  -20,    17,    68,    98,    86,    39,    -8,   -24 },
	{  -21,    14,    65,    97,    88,    43,    -5,   -25 },
	{  -22,    11,    62,    96,    90,    46,    -3,   -24 },
	{  -23,     8,    59,    95,    92,    49,     0,   -24 },
	{  -23,     5,    56,    94,    93,    53,     2,   -24 },
},
//I=16, D=51, wp= 0.020, ws= 0.022, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -14,    27,    75,    98,    78,    30,   -13,   -25 },
	{  -16,    24,    73,    97,    80,    34,   -11,   -25 },
	{  -18,    21,    70,    98,    82,    37,    -9,   -25 },
	{  -19,    18,    68,    95,    85,    40,    -6,   -25 },
	{  -20,    15,    65,    95,    87,    43,    -4,   -25 },
	{  -22,    12,    62,    96,    88,    47,    -2,   -25 },
	{  -23,     9,    59,    95,    90,    50,     1,   -25 },
	{  -23,     6,    56,    92,    92,    53,     4,   -24 },
},
//I=16, D=52, wp= 0.019, ws= 0.021, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -14,    28,    75,    98,    77,    31,   -12,   -27 },
	{  -15,    25,    72,    97,    79,    35,   -10,   -27 },
	{  -17,    22,    70,    95,    82,    38,    -7,   -27 },
	{  -19,    19,    67,    95,    84,    41,    -5,   -26 },
	{  -20,    16,    65,    94,    86,    44,    -3,   -26 },
	{  -21,    13,    62,    94,    87,    47,     0,   -26 },
	{  -22,    10,    59,    93,    89,    50,     2,   -25 },
	{  -23,     8,    56,    91,    90,    53,     5,   -24 },
},
//I=16, D=53, wp= 0.019, ws= 0.021, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -13,    29,    74,    96,    77,    32,   -11,   -28 },
	{  -15,    26,    72,    96,    79,    35,    -9,   -28 },
	{  -16,    23,    70,    94,    81,    38,    -6,   -28 },
	{  -18,    20,    67,    94,    83,    41,    -4,   -27 },
	{  -20,    17,    65,    94,    85,    44,    -2,   -27 },
	{  -21,    14,    62,    93,    86,    47,     1,   -26 },
	{  -22,    12,    59,    91,    88,    50,     3,   -25 },
	{  -23,     9,    56,    90,    89,    53,     6,   -24 },
},
//I=16, D=54, wp= 0.019, ws= 0.020, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -12,    30,    74,    94,    76,    33,   -10,   -29 },
	{  -14,    27,    72,    94,    78,    36,    -8,   -29 },
	{  -16,    24,    69,    93,    80,    39,    -5,   -28 },
	{  -17,    21,    67,    92,    82,    42,    -3,   -28 },
	{  -19,    18,    64,    92,    84,    45,    -1,   -27 },
	{  -21,    15,    62,    91,    85,    48,     2,   -26 },
	{  -22,    13,    59,    89,    87,    51,     4,   -25 },
	{  -23,    10,    56,    88,    88,    54,     7,   -24 },
},
//I=16, D=55, wp= 0.018, ws= 0.020, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -11,    31,    74,    91,    76,    34,    -9,   -30 },
	{  -13,    28,    71,    92,    78,    37,    -7,   -30 },
	{  -15,    25,    69,    91,    79,    40,    -4,   -29 },
	{  -17,    22,    67,    91,    81,    42,    -2,   -28 },
	{  -19,    19,    64,    91,    83,    45,     0,   -27 },
	{  -20,    16,    62,    90,    84,    48,     3,   -27 },
	{  -22,    14,    59,    89,    85,    51,     5,   -25 },
	{  -23,    11,    56,    87,    87,    54,     8,   -24 },
},
//I=16, D=56, wp= 0.018, ws= 0.020, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -10,    32,    73,    91,    75,    34,    -8,   -31 },
	{  -12,    29,    71,    90,    77,    37,    -6,   -30 },
	{  -14,    26,    69,    90,    79,    40,    -4,   -30 },
	{  -16,    23,    66,    90,    80,    43,    -1,   -29 },
	{  -18,    20,    64,    89,    82,    46,     1,   -28 },
	{  -20,    17,    61,    90,    83,    48,     4,   -27 },
	{  -21,    14,    59,    89,    84,    51,     6,   -26 },
	{  -23,    12,    56,    86,    86,    54,     9,   -24 },
},
//I=16, D=57, wp= 0.018, ws= 0.019, alpha= 0.100
//8taps-- Horizontal sampling
{
	{  -10,    32,    73,    90,    75,    35,    -7,   -32 },
	{  -12,    29,    71,    90,    76,    38,    -5,   -31 },
	{  -14,    26,    68,    91,    78,    40,    -3,   -30 },
	{  -16,    24,    66,    89,    79,    43,     0,   -29 },
	{  -18,    21,    64,    88,    81,    46,     2,   -28 },
	{  -19,    18,    61,    87,    82,    49,     5,   -27 },
	{  -21,    15,    59,    87,    83,    51,     7,   -25 },
	{  -23,    13,    56,    85,    85,    54,    10,   -24 },
},
//I=16, D=58, wp= 0.017, ws= 0.019, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -9,    33,    72,    89,    74,    36,    -7,   -32 },
	{  -11,    30,    70,    88,    76,    38,    -4,   -31 },
	{  -13,    27,    68,    88,    77,    41,    -2,   -30 },
	{  -15,    24,    66,    88,    79,    43,     0,   -29 },
	{  -17,    21,    63,    88,    80,    46,     3,   -28 },
	{  -19,    19,    61,    87,    81,    49,     5,   -27 },
	{  -21,    16,    59,    85,    83,    51,     8,   -25 },
	{  -22,    13,    56,    84,    84,    54,    11,   -24 },
},
//I=16, D=59, wp= 0.017, ws= 0.019, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -8,    33,    72,    88,    74,    36,    -6,   -33 },
	{  -10,    30,    70,    88,    75,    39,    -4,   -32 },
	{  -13,    28,    68,    87,    77,    41,    -1,   -31 },
	{  -15,    25,    65,    87,    78,    44,     1,   -29 },
	{  -17,    22,    63,    87,    79,    46,     4,   -28 },
	{  -18,    19,    61,    85,    81,    49,     6,   -27 },
	{  -20,    17,    58,    84,    82,    51,     9,   -25 },
	{  -22,    14,    56,    84,    83,    54,    11,   -24 },
},
//I=16, D=60, wp= 0.017, ws= 0.018, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -8,    34,    71,    88,    73,    36,    -5,   -33 },
	{  -10,    31,    69,    87,    75,    39,    -3,   -32 },
	{  -12,    28,    67,    88,    76,    41,    -1,   -31 },
	{  -14,    25,    65,    86,    77,    44,     2,   -29 },
	{  -16,    23,    63,    85,    79,    46,     4,   -28 },
	{  -18,    20,    61,    84,    80,    49,     7,   -27 },
	{  -20,    17,    58,    85,    81,    51,     9,   -25 },
	{  -22,    15,    56,    82,    82,    54,    12,   -23 },
},
//I=16, D=61, wp= 0.016, ws= 0.018, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -7,    34,    71,    87,    73,    37,    -5,   -34 },
	{   -9,    31,    69,    86,    74,    39,    -2,   -32 },
	{  -11,    29,    67,    85,    75,    42,     0,   -31 },
	{  -14,    26,    65,    84,    77,    44,     3,   -29 },
	{  -16,    23,    63,    84,    78,    47,     5,   -28 },
	{  -18,    21,    60,    83,    79,    49,     8,   -26 },
	{  -19,    18,    58,    83,    80,    51,    10,   -25 },
	{  -21,    15,    56,    81,    81,    54,    13,   -23 },
},
//I=16, D=62, wp= 0.016, ws= 0.018, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -6,    35,    71,    85,    72,    37,    -4,   -34 },
	{   -9,    32,    69,    84,    74,    40,    -2,   -32 },
	{  -11,    29,    67,    84,    75,    42,     1,   -31 },
	{  -13,    26,    64,    85,    76,    44,     3,   -29 },
	{  -15,    24,    62,    83,    77,    47,     6,   -28 },
	{  -17,    21,    60,    83,    78,    49,     8,   -26 },
	{  -19,    18,    58,    83,    79,    51,    11,   -25 },
	{  -21,    16,    56,    81,    80,    54,    13,   -23 },
},
//I=16, D=63, wp= 0.016, ws= 0.017, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -6,    35,    70,    85,    72,    37,    -3,   -34 },
	{   -8,    32,    68,    85,    73,    40,    -1,   -33 },
	{  -10,    30,    66,    84,    74,    42,     1,   -31 },
	{  -12,    27,    64,    83,    75,    44,     4,   -29 },
	{  -15,    24,    62,    84,    76,    47,     6,   -28 },
	{  -17,    22,    60,    81,    78,    49,     9,   -26 },
	{  -19,    19,    58,    82,    78,    51,    11,   -24 },
	{  -21,    16,    56,    81,    79,    53,    14,   -22 },
},
//I=16, D=72, wp= 0.014, ws= 0.015, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   -1,    37,    67,    78,    68,    39,     1,   -33 },
	{   -3,    34,    65,    77,    69,    41,     4,   -31 },
	{   -6,    32,    63,    78,    69,    43,     6,   -29 },
	{   -8,    30,    61,    76,    70,    45,     9,   -27 },
	{  -10,    27,    59,    76,    71,    47,    11,   -25 },
	{  -12,    25,    58,    75,    72,    48,    13,   -23 },
	{  -14,    22,    56,    76,    72,    50,    15,   -21 },
	{  -16,    20,    54,    74,    73,    52,    18,   -19 },
},


//I=16, D=80, wp= 0.013, ws= 0.014, alpha= 0.100
//8taps-- Horizontal sampling
{
	{    3,    37,    63,    74,    64,    39,     5,   -29 },
	{    1,    35,    61,    73,    65,    41,     7,   -27 },
	{   -1,    33,    60,    71,    65,    43,    10,   -25 },
	{   -4,    31,    58,    72,    66,    44,    12,   -23 },
	{   -6,    29,    57,    70,    67,    46,    14,   -21 },
	{   -8,    27,    55,    71,    67,    47,    16,   -19 },
	{  -10,    25,    54,    68,    68,    49,    18,   -16 },
	{  -12,    22,    52,    69,    68,    51,    20,   -14 },
},


//I=16, D=88, wp= 0.011, ws= 0.013, alpha= 0.100
//8taps-- Horizontal sampling
{
	{    7,    38,    59,    68,    60,    39,     9,   -24 },
	{    5,    36,    58,    66,    61,    41,    11,   -22 },
	{    3,    34,    57,    66,    61,    42,    13,   -20 },
	{    1,    32,    55,    66,    62,    43,    15,   -18 },
	{   -1,    30,    54,    65,    62,    45,    17,   -16 },
	{   -3,    28,    53,    64,    63,    46,    19,   -14 },
	{   -5,    26,    51,    66,    63,    47,    20,   -12 },
	{   -7,    24,    50,    64,    64,    49,    22,   -10 },
},


//I=16, D=96, wp= 0.010, ws= 0.011, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   10,    37,    56,    63,    57,    39,    12,   -18 },
	{    9,    36,    55,    61,    57,    40,    14,   -16 },
	{    7,    34,    53,    62,    57,    41,    16,   -14 },
	{    5,    32,    52,    62,    58,    42,    17,   -12 },
	{    3,    31,    51,    61,    58,    43,    19,   -10 },
	{    1,    29,    50,    60,    59,    44,    21,    -8 },
	{   -1,    27,    49,    61,    59,    45,    22,    -6 },
	{   -3,    26,    48,    59,    59,    47,    24,    -4 },
},


//I=16, D=104, wp= 0.010, ws= 0.011, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   14,    37,    52,    58,    53,    38,    15,   -11 },
	{   12,    35,    51,    58,    53,    39,    17,    -9 },
	{   11,    34,    50,    57,    54,    40,    18,    -8 },
	{    9,    32,    49,    57,    54,    41,    20,    -6 },
	{    7,    31,    48,    57,    54,    42,    21,    -4 },
	{    6,    30,    47,    56,    54,    43,    23,    -3 },
	{    4,    28,    46,    56,    55,    44,    24,    -1 },
	{    2,    27,    45,    56,    55,    45,    25,     1 },
},


//I=16, D=112, wp= 0.009, ws= 0.010, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   17,    36,    49,    54,    50,    37,    18,    -5 },
	{   15,    35,    48,    54,    50,    38,    19,    -3 },
	{   14,    34,    47,    53,    50,    39,    21,    -2 },
	{   13,    33,    47,    51,    50,    40,    22,     0 },
	{   11,    31,    46,    53,    51,    40,    23,     1 },
	{   10,    30,    45,    52,    51,    41,    24,     3 },
	{    8,    29,    44,    53,    51,    42,    25,     4 },
	{    7,    28,    43,    51,    51,    43,    27,     6 },
},


//I=16, D=120, wp= 0.008, ws= 0.009, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   20,    36,    46,    49,    47,    36,    21,     1 },
	{   18,    35,    45,    50,    47,    37,    22,     2 },
	{   17,    34,    45,    48,    47,    38,    23,     4 },
	{   16,    33,    44,    49,    47,    38,    24,     5 },
	{   15,    32,    43,    49,    47,    39,    25,     6 },
	{   13,    31,    43,    48,    48,    40,    26,     7 },
	{   12,    30,    42,    48,    48,    40,    27,     9 },
	{   11,    29,    42,    47,    48,    41,    28,    10 },
},


//I=16, D=128, wp= 0.008, ws= 0.009, alpha= 0.100
//8taps-- Horizontal sampling
{
	{   22,    35,    44,    46,    44,    36,    23,     6 },
	{   21,    34,    43,    48,    44,    36,    23,     7 },
	{   20,    33,    43,    47,    44,    37,    24,     8 },
	{   19,    33,    42,    46,    45,    37,    25,     9 },
	{   18,    32,    42,    45,    45,    38,    26,    10 },
	{   17,    31,    41,    46,    45,    38,    27,    11 },
	{   16,    30,    40,    46,    45,    39,    28,    12 },
	{   15,    29,    40,    47,    45,    39,    28,    13 },
},
};

short VO_coef_4t16p_ratio_[2][VO_16P_NUM_COEFF_RATIOS][8][4];
short VO_coef_8t16p_ratio_[2][VO_16P_NUM_COEFF_RATIOS][8][8];

void __iomem *Npp_Reg_Base;

static int pre_npp_hs_delta;
static int pre_npp_vs_delta;

void _WriteReg32(unsigned int addr, unsigned int val, unsigned int NPP_MODE_reg)
{
	unsigned int ofst = addr - NPP_MODE_reg;

	iowrite32(val, Npp_Reg_Base + ofst);
}

unsigned int _ReadReg32(unsigned int addr, unsigned int NPP_MODE_reg)
{
	unsigned int ofst = addr - NPP_MODE_reg;

	return ioread32(Npp_Reg_Base + ofst);
}

void _hw_rst_WriteReg32(void __iomem *rst_reg_base, unsigned int base,
unsigned int addr, unsigned int val)
{
	unsigned int ofst = addr - base;

	iowrite32(val, rst_reg_base + ofst);
}

unsigned int _hw_rst_ReadReg32(void __iomem *rst_reg_base, unsigned int base, unsigned int addr)
{
	unsigned int ofst = addr - base;

	return ioread32(rst_reg_base + ofst);
}

void _SetVideoScalingCoeffs16p(unsigned short *coeff, int delta_phase,
int init_phase, int taps, int swap, int di, int vsdn)
{
	int i;

	if (ABS(delta_phase - 0x10000) < 0x20 && init_phase == 0) {
		memset(coeff, 0, taps << 4); // taps * 16 / 2 * sizeof(short)
		for (i = 1; i <= 8; i++)
			coeff[(taps << 3) - i] = 0x1000; // set coeff[taps*8-1] ~ coeff[taps*8-8]
		//modified left shift from2 to 3 to fix coef error
	} else if (delta_phase >= 0x10000) { //scale down
		int end = 0;

		memset(coeff, 0, taps << 4); // taps * 16 / 2 * sizeof(short)
		end = taps * 8;
		if (delta_phase <= 0x20000 || (taps == 2 && delta_phase <= 0x40000)
		 || (di && delta_phase > (1 << 17)) || vsdn) {
			coeff[end - 16] = 0x111; coeff[end - 15] = 0x000;
			coeff[end - 14] = 0x333; coeff[end - 13] = 0x222;
			coeff[end - 12] = 0x555; coeff[end - 11] = 0x444;
			coeff[end - 10] = 0x777; coeff[end -  9] = 0x666;
			coeff[end -  8] = 0x999; coeff[end -  7] = 0x888;
			coeff[end -  6] = 0xbbb; coeff[end -  5] = 0xaaa;
			coeff[end -  4] = 0xddd; coeff[end -  3] = 0xccc;
			coeff[end -  2] = 0xfff; coeff[end -  1] = 0xeee;
		} else if (delta_phase <= 0x40000) {
			coeff[end - 32] = 0x0000; coeff[end - 31] = 0x0000;
			coeff[end - 30] = 0x0005; coeff[end - 29] = 0x0001;
			coeff[end - 28] = 0x0019; coeff[end - 27] = 0x000c;
			coeff[end - 26] = 0x0045; coeff[end - 25] = 0x002b;
			coeff[end - 24] = 0x0093; coeff[end - 23] = 0x0067;
			coeff[end - 22] = 0x010d; coeff[end - 21] = 0x00ca;
			coeff[end - 20] = 0x01bc; coeff[end - 19] = 0x015d;
			coeff[end - 18] = 0x02aa; coeff[end - 17] = 0x022b;
			coeff[end - 16] = 0x033b; coeff[end - 15] = 0x02aa;
			coeff[end - 14] = 0x0485; coeff[end - 13] = 0x03db;
			coeff[end - 12] = 0x05ed; coeff[end - 11] = 0x0537;
			coeff[end - 10] = 0x0754; coeff[end -  9] = 0x06a2;
			coeff[end -  8] = 0x089e; coeff[end -  7] = 0x07fe;
			coeff[end -  6] = 0x09ae; coeff[end -  5] = 0x092f;
			coeff[end -  4] = 0x0a66; coeff[end -  3] = 0x0a17;
			coeff[end -  2] = 0x0aaa; coeff[end -  1] = 0x0a99;
		} else {
			int k;

			    k = taps * 8; // taps*16/2
			for (i = 0; i < k; i++)
				coeff[i] = 0x1000/taps; //0x0400;
		}
	} else if (taps == 2) {
		// repeat 2t8p to 2t16p
		for (i = 0; i < 16; i += 2)
			coeff[i] = coeff[i+1] = VO_coef_2t8p[i >> 1];
	} else {
		/* find the best coefficient set based on scaling ratio */
		if (delta_phase >= 0x10000) { /* down-scaling */

			for (i = 1; i < VO_16P_NUM_COEFF_RATIOS - 1; i++) {
				// VscaleRatio is incrementing,
				// we find the first one that's bigger than or equal to delta
				// instead of min ads diff.
				// This way it will round up to lower pass filter to avoid alias
				if (VO_16p_ScaleRatio[i] >= delta_phase)
					break;
			}
		} else { /* upscaling */
			i = 0;
		}

		memcpy(coeff, taps == 4
		? VO_coef_4t16p_ratio_[swap][i][0] : VO_coef_8t16p_ratio_[swap][i][0],
		taps << 4); // taps * 16 / 2 * sizeof(short)
	}
}

void _NPP_Set_EngineGo(enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_INTST_reg = regs->NPP_INTST;
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int NPP_INTEN_reg = regs->NPP_INTEN;
	unsigned int NPP_FC_reg = regs->NPP_FC;

	_WriteReg32(NPP_INTST_reg, NPP_INTST_fin(1) | NPP_INTST_write_data(0), NPP_MODE_reg);
#if defined(ENABLE_NPP_ISR)
	_WriteReg32(NPP_INTEN_reg, NPP_INTEN_fin(1, target_soc) | NPP_INTEN_write_data(1), NPP_MODE_reg);
#else
	_WriteReg32(NPP_INTEN_reg, NPP_INTEN_fin(1, target_soc) | NPP_INTEN_write_data(0), NPP_MODE_reg);
#endif
	_WriteReg32(NPP_FC_reg, NPP_FC_go(1) | NPP_FC_write_data(1), NPP_MODE_reg);
}

void _NPP_Set_EngineStop(enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_INTST_reg = regs->NPP_INTST;
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int NPP_FC_reg = regs->NPP_FC;
#if defined(ENABLE_NPP_ISR)
	unsigned int NPP_INTEN_reg = regs->NPP_INTEN;

	_WriteReg32(NPP_INTEN_reg, NPP_INTEN_fin(1, target_soc) | NPP_INTEN_write_data(0), NPP_MODE_reg);
#endif
	_WriteReg32(NPP_INTST_reg, NPP_INTST_fin(1) | NPP_INTST_write_data(0), NPP_MODE_reg);
	_WriteReg32(NPP_FC_reg, NPP_FC_go(1) | NPP_FC_write_data(0), NPP_MODE_reg);
}

void _NPP_Get_INTStatus(unsigned char *is_finish, enum TARGET_SOC target_soc)
{
	unsigned int int_status = 0;
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_INTST_reg = regs->NPP_INTST;
	unsigned int NPP_MODE_reg = regs->NPP_MODE;

	int_status = _ReadReg32(NPP_INTST_reg, NPP_MODE_reg);

	if ((int_status & NPP_INTST_fin_mask) != 0) {
		*is_finish = 1;
		_WriteReg32(NPP_INTST_reg, NPP_INTST_fin(1) | NPP_INTST_write_data(0), NPP_MODE_reg);
		pr_info("[NPP] get int_status = 0x%x\n", int_status);
	} else {
		*is_finish = 0;
	}
}

/*
 * Func : NPP_HwClockEnable
 *
 * Desc : NPP module HW clock enable
 *
 * Parm : enable_clock: 1 is enable clock; 0 is disable clock
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_NPP_HwClock(unsigned char enable_clock, enum TARGET_SOC target_soc)
{
	unsigned int base_reg_addr = 0x98000000;
	unsigned int reg_addr_range = (0x980000C4 - 0x98000000) + 4;

	void __iomem *npp_reset_reg_base = ioremap(base_reg_addr, reg_addr_range);

	if (enable_clock == 1) {
		//enable NPP clock
		_hw_rst_WriteReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_CLOCK_ENABLE7,
		 (_hw_rst_ReadReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_CLOCK_ENABLE7)
		 & ~(SET_NPP_CLOCK(0x3))) | SET_NPP_CLOCK(0x3));
	} else {
		//disable NPP clock
		_hw_rst_WriteReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_CLOCK_ENABLE7,
		 (_hw_rst_ReadReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_CLOCK_ENABLE7)
		 & ~(SET_NPP_CLOCK(0x3))) | SET_NPP_CLOCK(0x2));
	}

	pr_info("[NPP] SYS_REG_CLOCK_ENABLE7 = 0x%x\n",
	 _hw_rst_ReadReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_CLOCK_ENABLE7));

#if defined(ENABLE_NPP_FPGA_TEST)
	if (target_soc == KENT) {
		// de-assert DIP MMU rstn
		_hw_rst_WriteReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_SOFT_RESET_MMU_SECURE,
		(_hw_rst_ReadReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_SOFT_RESET_MMU_SECURE)
		& ~(SET_DIP_MMU_RESET(0x3))) | SET_DIP_MMU_RESET(0x3));
		pr_info("[NPP] SYS_REG_SOFT_RESET_MMU_SECURE = 0x%x\n",
		_hw_rst_ReadReg32(npp_reset_reg_base, base_reg_addr, SYS_REG_SOFT_RESET_MMU_SECURE));
	}
#endif

	iounmap(npp_reset_reg_base);
	npp_reset_reg_base = NULL;

	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Init
 *
 * Desc : NPP SW initialize
 *
 * NOTE: system MUST call NPP_Init() prior to operate NPP due to driver needs to do some initialize.
 *
 * Parm : target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Init(enum TARGET_SOC target_soc)
{
	int taps, swap, idx;
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int base_reg_addr = regs->NPP_MODE;
	unsigned int reg_NPP_SRAM_RM = regs->NPP_SRAM_RM;
	unsigned int reg_NPP_TIMEOUT = regs->NPP_TIMEOUT;
	unsigned int reg_addr_range = 0;


	Npp_Reg_Base = NULL;
	pre_npp_hs_delta = 0;
	pre_npp_vs_delta = 0;

	/* re-order scaling coefficients to HW register ordering */
	/* 16-phase 4-tap and 8-tap */
	for (taps = 4; taps <= 8; taps += 4) {
		for (swap = 0; swap <  2; swap++) {
			for (idx  = 0; idx  <  VO_16P_NUM_COEFF_RATIOS; idx++) {
				short const *p = taps == 4
				? VO_coef_4t16p_ratio[idx][0]
				: VO_coef_8t16p_ratio[idx][0];
				short   *coeff = taps == 4
				? VO_coef_4t16p_ratio_[swap][idx][0]
				: VO_coef_8t16p_ratio_[swap][idx][0];
				int i;

				for (i = 0; i < taps << 3; i++) {
					int x = i &  15;
					int y = i >> 4;

					coeff[i^swap] = (x < 8
					? p[x * taps + taps-1-y] : p[(15-x) * taps + y]) << 4;
				}
			}
		}
	}

	if (target_soc == STARK || target_soc == KENT)
		reg_addr_range = (reg_NPP_SRAM_RM - base_reg_addr) + 4;
	else
		reg_addr_range = (reg_NPP_TIMEOUT - base_reg_addr) + 4;

	Npp_Reg_Base = ioremap(base_reg_addr, reg_addr_range);
	if (Npp_Reg_Base == NULL) {
		pr_err("%s, npp register ioremap failed\n", __func__);
		return NPP_STATUS_FAILED;
	}

	pr_info("[NPP] init done\n");
	return NPP_STATUS_OK;
}

/*
 * Func : NPP_UnInit
 *
 * Desc : NPP SW un-init
 *
 * NOTE: system MUST call NPP_UnInit() for releasing some resources.
 *
 * Parm : target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_UnInit(enum TARGET_SOC target_soc)
{
	_NPP_Set_EngineStop(target_soc);

	iounmap(Npp_Reg_Base);
	Npp_Reg_Base = NULL;

	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_InputImageFormat
 *
 * Desc : set NPP input stream image data format
 *
 * Parm : src_input[in]: input stream image data format
 *            target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Set_InputImageFormat(struct Npp_InputImageFormat *src_input, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_VI_SIZE = regs->NPP_VI_SIZE;
	unsigned int NPP_VI_reg = regs->NPP_VI;
	unsigned int NPP_VI_PACKED_reg = regs->NPP_VI_PACKED;
	unsigned int NPP_VI_SEQ_PITCH_C_Y_reg = regs->NPP_VI_SEQ_PITCH_C_Y;
	unsigned int NPP_VI_SEQ_PITCH_C_C_reg = regs->NPP_VI_SEQ_PITCH_C_C;

	unsigned int vi_cinfig_setting = 0;
	unsigned int vi_config_reset =  NPP_VI_yuv_packed_mask |
									NPP_VI_source_mask     |
									NPP_VI_nv21_mask       |
									NPP_VI_ppc10b_mask     |
									NPP_VI_f422_mask;
	_WriteReg32(NPP_VI_reg, vi_config_reset | NPP_VI_write_data(0), NPP_MODE_reg);

	vi_cinfig_setting |= (src_input->yuv_format >= PACKED_YUYV
	&& src_input->yuv_format <= PACKED_VYUY)
	 ? NPP_VI_yuv_packed_mask : 0;
	vi_cinfig_setting |= (src_input->source == SOURCE_VE_MODE)
	 ? NPP_VI_source_mask : 0;
	vi_cinfig_setting |= (src_input->yuv_format == NV21_VU)
	? NPP_VI_nv21_mask : 0;
	vi_cinfig_setting |= (src_input->bit_depth == 10)
	? NPP_VI_ppc10b_mask : 0;
	vi_cinfig_setting |= (src_input->yuv_sample == YUV_422)
	? NPP_VI_f422_mask : 0;

	_WriteReg32(NPP_VI_reg, vi_cinfig_setting | NPP_VI_write_data(1), NPP_MODE_reg);

	if (src_input->yuv_format >= PACKED_YUYV && src_input->yuv_format <= PACKED_VYUY) {
		_WriteReg32(NPP_VI_PACKED_reg, NPP_VI_PACKED_fmt(src_input->yuv_format), NPP_MODE_reg);
		pr_info("[NPP] NPP_VI_PACKED(0x%x) = 0x%x\n",
		 NPP_VI_PACKED_reg, _ReadReg32(NPP_VI_PACKED_reg, NPP_MODE_reg));
	}

	_WriteReg32(reg_NPP_VI_SIZE, 0x00, NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_SIZE,
	 (NPP_VI_SIZE_w(src_input->src_width) | NPP_VI_SIZE_h(src_input->src_height)), NPP_MODE_reg);

	if (src_input->yuv_format >= PACKED_YUYV && src_input->yuv_format <= PACKED_VYUY) {
		_WriteReg32(NPP_VI_SEQ_PITCH_C_Y_reg, NPP_VI_SEQ_PITCH_C_Y_p(src_input->pitch), NPP_MODE_reg);
	} else {
		_WriteReg32(NPP_VI_SEQ_PITCH_C_Y_reg, NPP_VI_SEQ_PITCH_C_Y_p(src_input->pitch), NPP_MODE_reg);
		_WriteReg32(NPP_VI_SEQ_PITCH_C_C_reg, NPP_VI_SEQ_PITCH_C_C_p(src_input->pitch), NPP_MODE_reg);
	}

	pr_info("[NPP] NPP_VI(0x%x) = 0x%x, VI_SIZE(0x%x) = 0x%x\n",
	NPP_VI_reg, _ReadReg32(NPP_VI_reg, NPP_MODE_reg), reg_NPP_VI_SIZE, _ReadReg32(reg_NPP_VI_SIZE, NPP_MODE_reg));
	pr_info("[NPP] VI_SEQ_PITCH_C_Y(0x%x) = 0x%x, VI_SEQ_PITCH_C_C(0x%x) = 0x%x\n",
	NPP_VI_SEQ_PITCH_C_Y_reg, _ReadReg32(NPP_VI_SEQ_PITCH_C_Y_reg, NPP_MODE_reg),
	NPP_VI_SEQ_PITCH_C_C_reg, _ReadReg32(NPP_VI_SEQ_PITCH_C_C_reg, NPP_MODE_reg));
	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_InputSrcBuffer
 *
 * Desc : set NPP input buffer related parameters
 *
 * Parm : input_buffer[in]: input buffer information
 *            target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Set_InputDataBuffer(struct Npp_InputBufInfo *input_buffer, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int NPP_VI_reg = regs->NPP_VI;
	unsigned int NPP_VI_SEQ_SA_C_Y_reg = regs->NPP_VI_SEQ_SA_C_Y;
	unsigned int NPP_VI_SEQ_SA_C_C_reg = regs->NPP_VI_SEQ_SA_C_C;
	unsigned int NPP_VI_SEQ_SA_W_Y_reg = regs->NPP_VI_SEQ_SA_W_Y;
	unsigned int NPP_VI_SEQ_SA_W_C_reg = regs->NPP_VI_SEQ_SA_W_C;
	unsigned char vi_topfiled = 0;
	unsigned char vi_dmaweave = 0;
	unsigned char vi_yuv_packed = 0;

	unsigned int vi_cinfig_setting = 0;
	unsigned int vi_config_reset =  NPP_VI_st_mask         |
									NPP_VI_topfield_mask   |
									NPP_VI_dmaweave_mask;

	_WriteReg32(NPP_VI_reg, vi_config_reset | NPP_VI_write_data(0), NPP_MODE_reg);

	vi_cinfig_setting |=
	(input_buffer->scan_mode != CONSECUTIVE_FRAME
	&& input_buffer->scan_mode != CONSECUTIVE_FRAME_422)
	? NPP_VI_dmaweave_mask : 0;

	vi_cinfig_setting |= (input_buffer->scan_mode == INTERLEAVED_TOP_FIELD ||
						input_buffer->scan_mode == INTERLEAVED_BOT_FIELD ||
						input_buffer->scan_mode ==
						INTERLEAVED_TOP_FIELD_422 ||
						input_buffer->scan_mode == INTERLEAVED_BOT_FIELD_422
						)
						? NPP_VI_st_mask : 0;

	vi_cinfig_setting |= (input_buffer->scan_mode != INTERLEAVED_BOT_FIELD &&
						input_buffer->scan_mode !=
						INTERLEAVED_BOT_FIELD_422 &&
						input_buffer->scan_mode != CONSECUTIVE_BOT_FIELD &&
						input_buffer->scan_mode != CONSECUTIVE_BOT_FIELD_422
						)
						? NPP_VI_topfield_mask : 0;

	_WriteReg32(NPP_VI_reg, vi_cinfig_setting
	| NPP_VI_write_data(1), NPP_MODE_reg);

	// topfield: 1 current feild is top; 0 current feild is bottom
	vi_topfiled = ((vi_cinfig_setting & NPP_VI_topfield_mask) != 0) ? 1 : 0;
	vi_dmaweave = ((vi_cinfig_setting & NPP_VI_dmaweave_mask) != 0) ? 1 : 0;
	vi_yuv_packed = NPP_VI_yuv_packed_src(_ReadReg32(NPP_VI_reg, NPP_MODE_reg));

	if (target_soc == STARK) {
		if (vi_dmaweave == 0) { // progressive
			_WriteReg32(NPP_VI_SEQ_SA_C_Y_reg,
			 NPP_VI_SEQ_SA_C_Y_a(input_buffer->top_filed_y_addr), NPP_MODE_reg);
			_WriteReg32(NPP_VI_SEQ_SA_C_C_reg,
			 NPP_VI_SEQ_SA_C_C_a(input_buffer->top_filed_c_addr), NPP_MODE_reg);
		} else { // interlace
			if (vi_topfiled == 1) {
				_WriteReg32(NPP_VI_SEQ_SA_C_Y_reg,
				 NPP_VI_SEQ_SA_C_Y_a(input_buffer->top_filed_y_addr), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_C_C_reg,
				 NPP_VI_SEQ_SA_C_C_a(input_buffer->top_filed_c_addr), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_Y_reg,
				 NPP_VI_SEQ_SA_W_Y_a(input_buffer->bottom_filed_y_addr), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_C_reg,
				 NPP_VI_SEQ_SA_W_C_a(input_buffer->bottom_filed_c_addr), NPP_MODE_reg);
			} else {
				_WriteReg32(NPP_VI_SEQ_SA_C_Y_reg,
				 NPP_VI_SEQ_SA_C_Y_a(input_buffer->bottom_filed_y_addr), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_C_C_reg,
				 NPP_VI_SEQ_SA_C_C_a(input_buffer->bottom_filed_c_addr), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_Y_reg,
				 NPP_VI_SEQ_SA_W_Y_a(input_buffer->top_filed_y_addr), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_C_reg,
				 NPP_VI_SEQ_SA_W_C_a(input_buffer->top_filed_c_addr), NPP_MODE_reg);
			}
		}
	} else {
		if (vi_yuv_packed == 1) {
			_WriteReg32(NPP_VI_SEQ_SA_C_Y_reg,
			NPP_VI_SEQ_SA_C_Y_a((input_buffer->top_filed_y_addr >> 4)), NPP_MODE_reg);
			pr_info("[NPP] NPP_VI(0x%x) = 0x%x, VI_SEQ_SA_C_Y(0x%x) = 0x%x\n",
			 NPP_VI_reg, _ReadReg32(NPP_VI_reg, NPP_MODE_reg),
			 NPP_VI_SEQ_SA_C_Y_reg, _ReadReg32(NPP_VI_SEQ_SA_C_Y_reg, NPP_MODE_reg));
			return NPP_STATUS_OK;
		}

		if (vi_dmaweave == 0) { // progressive
			_WriteReg32(NPP_VI_SEQ_SA_C_Y_reg,
			 NPP_VI_SEQ_SA_C_Y_a((input_buffer->top_filed_y_addr >> 4)), NPP_MODE_reg);
			_WriteReg32(NPP_VI_SEQ_SA_C_C_reg,
			 NPP_VI_SEQ_SA_C_C_a((input_buffer->top_filed_c_addr >> 4)), NPP_MODE_reg);
		} else { // interlace
			if (vi_topfiled == 1) {
				_WriteReg32(NPP_VI_SEQ_SA_C_Y_reg,
				 NPP_VI_SEQ_SA_C_Y_a((input_buffer->top_filed_y_addr >> 4)), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_C_C_reg,
				 NPP_VI_SEQ_SA_C_C_a((input_buffer->top_filed_c_addr >> 4)), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_Y_reg,
				 NPP_VI_SEQ_SA_W_Y_a((input_buffer->bottom_filed_y_addr >> 4)), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_C_reg,
				 NPP_VI_SEQ_SA_W_C_a((input_buffer->bottom_filed_c_addr >> 4)), NPP_MODE_reg);
			} else {
				_WriteReg32(NPP_VI_SEQ_SA_C_Y_reg,
				 NPP_VI_SEQ_SA_C_Y_a((input_buffer->bottom_filed_y_addr >> 4)), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_C_C_reg,
				 NPP_VI_SEQ_SA_C_C_a((input_buffer->bottom_filed_c_addr >> 4)), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_Y_reg,
				 NPP_VI_SEQ_SA_W_Y_a((input_buffer->top_filed_y_addr >> 4)), NPP_MODE_reg);
				_WriteReg32(NPP_VI_SEQ_SA_W_C_reg,
				 NPP_VI_SEQ_SA_W_C_a((input_buffer->top_filed_c_addr >> 4)), NPP_MODE_reg);
			}
		}
	}

	pr_info("[NPP] NPP_VI(0x%x) = 0x%x\n", NPP_VI_reg, _ReadReg32(NPP_VI_reg, NPP_MODE_reg));
	pr_info("[NPP] VI_SEQ_SA_C_Y(0x%x) = 0x%x, VI_SEQ_SA_C_C(0x%x) = 0x%x\n",
	 NPP_VI_SEQ_SA_C_Y_reg, _ReadReg32(NPP_VI_SEQ_SA_C_Y_reg, NPP_MODE_reg),
	 NPP_VI_SEQ_SA_C_C_reg, _ReadReg32(NPP_VI_SEQ_SA_C_C_reg, NPP_MODE_reg));
	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_OutputImageFormat
 *
 * Desc : set NPP output stream image data format
 *
 * Parm : tgt_output[in]: output stream image data format
 *            target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Set_OutputImageFormat(struct Npp_OutputImageFormat *tgt_output, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_WB = regs->NPP_WB;
	unsigned int reg_NPP_NORM = regs->NPP_NORM;
	unsigned int reg_NPP_WB_SEQ_PITCH = regs->NPP_WB_SEQ_PITCH;
	unsigned int reg_NPP_NORM_R, reg_NPP_NORM_G, reg_NPP_NORM_B;
	unsigned int reg_NPP_NORM_M_R, reg_NPP_NORM_S_R, reg_NPP_NORM_MAX_R, reg_NPP_NORM_MIN_R;
	unsigned int reg_NPP_NORM_M_G, reg_NPP_NORM_S_G, reg_NPP_NORM_MAX_G, reg_NPP_NORM_MIN_G;
	unsigned int reg_NPP_NORM_M_B, reg_NPP_NORM_S_B, reg_NPP_NORM_MAX_B, reg_NPP_NORM_MIN_B;

	unsigned int wb_pitch;
	unsigned char rgb_format = 0;
	unsigned int wb_config_setting = 0;
	unsigned int wb_config_reset =  NPP_WB_yuv_mask;
	unsigned int norm_setting_value;
	unsigned int norm_scale;
	int norm_min, norm_max;

	rgb_format = NPP_WB_fmt_src(_ReadReg32(reg_NPP_WB, NPP_MODE_reg));

	if (target_soc != STARK && target_soc != KENT)
		wb_config_reset |= NPP_WB_bit_mask;

	_WriteReg32(reg_NPP_WB, wb_config_reset | NPP_WB_write_data(0), NPP_MODE_reg);

	wb_config_setting |= (tgt_output->wb_format == YUV_MODE)
	? NPP_WB_yuv_mask : 0;

	if (target_soc != STARK && target_soc != KENT)
		wb_config_setting |= (tgt_output->rgb_bit_mode == MODE_16bit)
		? NPP_WB_bit_mask : 0;

	_WriteReg32(reg_NPP_WB, wb_config_setting | NPP_WB_write_data(1), NPP_MODE_reg);

	if (tgt_output->rgb_level == NEGATIVE_LEVEL)
		_WriteReg32(reg_NPP_NORM, NPP_NORM_sign(NEGATIVE_LEVEL), NPP_MODE_reg);
	else
		_WriteReg32(reg_NPP_NORM, NPP_NORM_sign(POSITIVE_LEVEL), NPP_MODE_reg);

	if (target_soc == STARK || target_soc == KENT) {

		unsigned int norm_mean;

		reg_NPP_NORM_R = regs->NPP_NORM_R;
		reg_NPP_NORM_G = regs->NPP_NORM_G;
		reg_NPP_NORM_B = regs->NPP_NORM_B;

		norm_mean = 128;
		norm_scale = FLOAT_TO_FIXED_POINT_UNSIGNED(1.0, 9); // 9 bit binary fraction
		norm_setting_value = NPP_NORM_mean(norm_mean, target_soc) | NPP_NORM_scale_8bit(norm_scale, target_soc);

		_WriteReg32(reg_NPP_NORM_R, norm_setting_value, NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_G, norm_setting_value, NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_B, norm_setting_value, NPP_MODE_reg);

		pr_info("[NPP] NPP_NORM_R(0x%x) = 0x%x, NPP_NORM_G(0x%x) = 0x%x, NPP_NORM_B(0x%x) = 0x%x\n",
			reg_NPP_NORM_R, _ReadReg32(reg_NPP_NORM_R, NPP_MODE_reg), reg_NPP_NORM_G,
			_ReadReg32(reg_NPP_NORM_G, NPP_MODE_reg), reg_NPP_NORM_B, _ReadReg32(reg_NPP_NORM_B, NPP_MODE_reg));

	} else {

		int norm_mean;

		reg_NPP_NORM_M_R = regs->NPP_NORM_M_R;
		reg_NPP_NORM_M_G = regs->NPP_NORM_M_G;
		reg_NPP_NORM_M_B = regs->NPP_NORM_M_B;
		reg_NPP_NORM_S_R = regs->NPP_NORM_S_R;
		reg_NPP_NORM_S_G = regs->NPP_NORM_S_G;
		reg_NPP_NORM_S_B = regs->NPP_NORM_S_B;
		reg_NPP_NORM_MAX_R = regs->NPP_NORM_MAX_R;
		reg_NPP_NORM_MAX_G = regs->NPP_NORM_MAX_G;
		reg_NPP_NORM_MAX_B = regs->NPP_NORM_MAX_B;
		reg_NPP_NORM_MIN_R = regs->NPP_NORM_MIN_R;
		reg_NPP_NORM_MIN_G = regs->NPP_NORM_MIN_G;
		reg_NPP_NORM_MIN_B = regs->NPP_NORM_MIN_B;

		if (tgt_output->rgb_level == NEGATIVE_LEVEL) {
			norm_mean = FLOAT_TO_FIXED_POINT_SIGNED(128.0, 16); // 16 bit binary fraction
			norm_scale = FLOAT_TO_FIXED_POINT_UNSIGNED(1.0, 17); // 17 bit binary fraction
			norm_max = 127;
			norm_min = -128;
		} else {
			norm_mean = FLOAT_TO_FIXED_POINT_SIGNED(0.0, 16); // 16 bit binary fraction
			norm_scale = FLOAT_TO_FIXED_POINT_UNSIGNED(1.0, 17); // 17 bit binary fraction
			norm_max = 255;
			norm_min = 0;
		}

		_WriteReg32(reg_NPP_NORM_M_R, NPP_NORM_mean(norm_mean, target_soc), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_M_G, NPP_NORM_mean(norm_mean, target_soc), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_M_B, NPP_NORM_mean(norm_mean, target_soc), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_S_R, NPP_NORM_scale_8bit(norm_scale, target_soc), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_S_G, NPP_NORM_scale_8bit(norm_scale, target_soc), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_S_B, NPP_NORM_scale_8bit(norm_scale, target_soc), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_MAX_R, NPP_NORM_max(norm_max), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_MAX_G, NPP_NORM_max(norm_max), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_MAX_B, NPP_NORM_max(norm_max), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_MIN_R, NPP_NORM_min(norm_min), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_MIN_G, NPP_NORM_min(norm_min), NPP_MODE_reg);
		_WriteReg32(reg_NPP_NORM_MIN_B, NPP_NORM_min(norm_min), NPP_MODE_reg);

		pr_info("[NPP] NPP_NORM_M_R(0x%x) = 0x%x, NPP_NORM_M_G(0x%x) = 0x%x, NPP_NORM_M_B(0x%x) = 0x%x\n",
			reg_NPP_NORM_M_R, _ReadReg32(reg_NPP_NORM_M_R, NPP_MODE_reg), reg_NPP_NORM_M_G,
			_ReadReg32(reg_NPP_NORM_M_G, NPP_MODE_reg), reg_NPP_NORM_M_B, _ReadReg32(reg_NPP_NORM_M_B, NPP_MODE_reg));
		pr_info("[NPP] NPP_NORM_S_R(0x%x) = 0x%x, NPP_NORM_S_G(0x%x) = 0x%x, NPP_NORM_S_B(0x%x) = 0x%x\n",
			reg_NPP_NORM_S_R, _ReadReg32(reg_NPP_NORM_S_R, NPP_MODE_reg), reg_NPP_NORM_S_G,
			_ReadReg32(reg_NPP_NORM_S_G, NPP_MODE_reg), reg_NPP_NORM_S_B, _ReadReg32(reg_NPP_NORM_S_B, NPP_MODE_reg));
		pr_info("[NPP] NPP_NORM_MAX_R(0x%x) = 0x%x, NPP_NORM_MAX_G(0x%x) = 0x%x, NPP_NORM_MAX_B(0x%x) = 0x%x\n",
			reg_NPP_NORM_MAX_R, _ReadReg32(reg_NPP_NORM_MAX_R, NPP_MODE_reg), reg_NPP_NORM_MAX_G,
			_ReadReg32(reg_NPP_NORM_MAX_G, NPP_MODE_reg), reg_NPP_NORM_MAX_B, _ReadReg32(reg_NPP_NORM_MAX_B, NPP_MODE_reg));
		pr_info("[NPP] NPP_NORM_MIN_R(0x%x) = 0x%x, NPP_NORM_MIN_G(0x%x) = 0x%x, NPP_NORM_MIN_B(0x%x) = 0x%x\n",
			reg_NPP_NORM_MIN_R, _ReadReg32(reg_NPP_NORM_MIN_R, NPP_MODE_reg), reg_NPP_NORM_MIN_G,
			_ReadReg32(reg_NPP_NORM_MIN_G, NPP_MODE_reg), reg_NPP_NORM_MIN_B, _ReadReg32(reg_NPP_NORM_MIN_B, NPP_MODE_reg));
	}

	wb_pitch = ((tgt_output->tgt_width + 15) >> 4) << 4; //align 16
	if (rgb_format == 0)
		_WriteReg32(reg_NPP_WB_SEQ_PITCH, NPP_WB_SEQ_PITCH_p(wb_pitch), NPP_MODE_reg);
	else
		_WriteReg32(reg_NPP_WB_SEQ_PITCH, NPP_WB_SEQ_PITCH_p((wb_pitch * 3)), NPP_MODE_reg);

	pr_info("[NPP] NPP_WB(0x%x) = 0x%x, WB_SEQ_PITCH(0x%x) = 0x%x, NPP_NORM(0x%x) = 0x%x\n",
	 reg_NPP_WB, _ReadReg32(reg_NPP_WB, NPP_MODE_reg), reg_NPP_WB_SEQ_PITCH,
	 _ReadReg32(reg_NPP_WB_SEQ_PITCH, NPP_MODE_reg), reg_NPP_NORM, _ReadReg32(reg_NPP_NORM, NPP_MODE_reg));

	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_OutputRGBFormat
 *
 * Desc : set NPP output RGB format
 *
 * Parm : rgb_format[in]: output RGB format
 *            target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Set_OutputRGBFormat(enum NPP_RGB_FORMAT rgb_format, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_WB = regs->NPP_WB;
	unsigned int wb_config_value = 0;

	wb_config_value = NPP_WB_fmt_mask;
	_WriteReg32(reg_NPP_WB, wb_config_value | NPP_WB_write_data(0), NPP_MODE_reg);

	if (rgb_format == SINGLE_PLANE_RGB) {
		wb_config_value = NPP_WB_fmt_mask;
		_WriteReg32(reg_NPP_WB, wb_config_value | NPP_WB_write_data(1), NPP_MODE_reg);
		pr_info("[NPP] rgb_format = %d, set NPP_WB_fmt_mask(0x%x)\n",
		 rgb_format, wb_config_value);
	}

	pr_info("[NPP] rgb_format = %d, NPP_WB(0x%x) = 0x%x\n",
	 rgb_format, reg_NPP_WB, _ReadReg32(reg_NPP_WB, NPP_MODE_reg));
	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_OutputDataBuffer
 *
 * Desc : set NPP output buffer related parameters
 *
 * Parm : output_buffer[in]: output buffer information
 *            target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Set_OutputDataBuffer(struct Npp_OutputBufInfo *output_buffer, enum TARGET_SOC target_soc)
{
	unsigned char rgb_format = 0;
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_WB = regs->NPP_WB;
	unsigned int reg_NPP_WB_SEQ_SA_R = regs->NPP_WB_SEQ_SA_R;
	unsigned int reg_NPP_WB_SEQ_SA_G = regs->NPP_WB_SEQ_SA_G;
	unsigned int reg_NPP_WB_SEQ_SA_B = regs->NPP_WB_SEQ_SA_B;

	rgb_format = NPP_WB_fmt_src(_ReadReg32(reg_NPP_WB, NPP_MODE_reg));

	if (target_soc == STARK) {
		if (rgb_format == SINGLE_PLANE_RGB) {
			_WriteReg32(reg_NPP_WB_SEQ_SA_R,
			 NPP_WB_SEQ_SA_R_a(output_buffer->r_addr), NPP_MODE_reg);
		} else {
			_WriteReg32(reg_NPP_WB_SEQ_SA_R,
			 NPP_WB_SEQ_SA_R_a(output_buffer->r_addr), NPP_MODE_reg);
			_WriteReg32(reg_NPP_WB_SEQ_SA_G,
			 NPP_WB_SEQ_SA_G_a(output_buffer->g_addr), NPP_MODE_reg);
			_WriteReg32(reg_NPP_WB_SEQ_SA_B,
			 NPP_WB_SEQ_SA_B_a(output_buffer->b_addr), NPP_MODE_reg);
		}
	} else {
		if (rgb_format == SINGLE_PLANE_RGB) {
			_WriteReg32(reg_NPP_WB_SEQ_SA_R,
			 NPP_WB_SEQ_SA_R_a((output_buffer->r_addr >> 4)), NPP_MODE_reg);
		} else {
			_WriteReg32(reg_NPP_WB_SEQ_SA_R,
			 NPP_WB_SEQ_SA_R_a((output_buffer->r_addr >> 4)), NPP_MODE_reg);
			_WriteReg32(reg_NPP_WB_SEQ_SA_G,
			 NPP_WB_SEQ_SA_G_a((output_buffer->g_addr >> 4)), NPP_MODE_reg);
			_WriteReg32(reg_NPP_WB_SEQ_SA_B,
			 NPP_WB_SEQ_SA_B_a((output_buffer->b_addr >> 4)), NPP_MODE_reg);
		}
	}

	pr_info("[NPP] rgb_format = %d, WB_SEQ_SA_R(0x%x) = 0x%x, WB_SEQ_SA_G(0x%x) = 0x%x,WB_SEQ_SA_B(0x%x) = 0x%x\n",
	 rgb_format, reg_NPP_WB_SEQ_SA_R, _ReadReg32(reg_NPP_WB_SEQ_SA_R, NPP_MODE_reg),
	 reg_NPP_WB_SEQ_SA_G, _ReadReg32(reg_NPP_WB_SEQ_SA_G, NPP_MODE_reg), reg_NPP_WB_SEQ_SA_B,
	   _ReadReg32(reg_NPP_WB_SEQ_SA_B, NPP_MODE_reg));
	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_ColorSpaceConversion
 *
 * Desc : set NPP color space conversion
 *
 * NOTE: the parameters of color space conversion are FIXED,
 * there is no difference between Rec. 601 and Rec. 709.
 *
 * Parm : target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Set_ColorSpaceConversion(enum TARGET_SOC target_soc)
{
	int m00, m01, m02, m10, m11, m12, m20, m21, m22;
	int a0, a1, a2;

	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_VI_CC1 = regs->NPP_VI_CC1;
	unsigned int reg_NPP_VI_CC2 = regs->NPP_VI_CC2;
	unsigned int reg_NPP_VI_CC3 = regs->NPP_VI_CC3;
	unsigned int reg_NPP_VI_CC4 = regs->NPP_VI_CC4;
	unsigned int reg_NPP_VI_CC5 = regs->NPP_VI_CC5;
	unsigned int reg_NPP_VI_CC6 = regs->NPP_VI_CC6;
	unsigned int reg_NPP_VI_CC7 = regs->NPP_VI_CC7;

	m00 = 2048;
	m01 = 2048;
	m02 = 2048;

	m10 = 0;
	m11 = 15999;
	m12 = 3800;

	m20 = 3225;
	m21 = 15424;
	m22 = 0;

	a0 = 1242;
	a1 = 336;
	a2 = 1098;

	_WriteReg32(reg_NPP_VI_CC1, NPP_VI_CC1_m01(m01) | NPP_VI_CC1_m00(m00), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_CC2, NPP_VI_CC2_m10(m10) | NPP_VI_CC2_m02(m02), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_CC3, NPP_VI_CC3_m12(m12) | NPP_VI_CC3_m11(m11), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_CC4, NPP_VI_CC4_m21(m21) | NPP_VI_CC4_m20(m20), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_CC5, NPP_VI_CC5_m22(m22), NPP_MODE_reg);

	_WriteReg32(reg_NPP_VI_CC6, NPP_VI_CC6_a1(a1) | NPP_VI_CC6_a0(a0), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_CC7, NPP_VI_CC7_a2(a2), NPP_MODE_reg);

	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_ScalerCoefficient
 *
 * Desc : set NPP scaler coefficient
 *
 * Parm : image_scaling[in] : scaling information for scaler settings
 *            target_soc: SOC board
 *
 * Retn : NPP_STATUS_OK / NPP_STATUS_FAILED
 */
unsigned int NPP_Set_ScalerCoefficient(struct Npp_ImageScalingInfo *image_scaling, enum TARGET_SOC target_soc)
{
	struct NPP_VI_VSYC_STR npp_vi_vsyc[16];
	struct NPP_VI_VSCC_STR npp_vi_vscc[16];
	struct NPP_VI_HSYC_STR npp_vi_hsyc[32];
	struct NPP_VI_HSCC_STR npp_vi_hscc[16];

	unsigned int vsyi_phase, vsci_phase, hsi_phase;

	unsigned int vsd_delta, hsd_delta;
	unsigned int v_offset_c, v_phase_c;
	unsigned int vi_scaler_config_reset = 0, vi_scaler_config_set = 0;

	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int NPP_VI_reg = regs->NPP_VI;
	unsigned int reg_NPP_VI_VSYI = regs->NPP_VI_VSYI;
	unsigned int reg_NPP_VI_VSCI = regs->NPP_VI_VSCI;
	unsigned int reg_NPP_VI_HSI = regs->NPP_VI_HSI;
	unsigned int reg_NPP_VI_HSD_W = regs->NPP_VI_HSD_W;
	unsigned int reg_NPP_VI_VSD_H = regs->NPP_VI_VSD_H;
	unsigned int reg_NPP_VI_VSD = regs->NPP_VI_VSD;
	unsigned int reg_NPP_VI_HSD = regs->NPP_VI_HSD;
	unsigned int reg_NPP_VI_VSYC_0 = regs->NPP_VI_VSYC_0;
	unsigned int reg_NPP_VI_VSCC_0 = regs->NPP_VI_VSCC_0;
	unsigned int reg_NPP_VI_HSYC_0 = regs->NPP_VI_HSYC_0;
	unsigned int reg_NPP_VI_HSCC_0 = regs->NPP_VI_HSCC_0;

	unsigned char isYUV420 = (NPP_VI_f422_src(_ReadReg32(NPP_VI_reg, NPP_MODE_reg)) == 1) ? 0 : 1;
	unsigned char vi_st = NPP_VI_st_src(_ReadReg32(NPP_VI_reg, NPP_MODE_reg));


	if (image_scaling->crop_pos.win_y != 0) {
		_WriteReg32(reg_NPP_VI_VSYI,
		 NPP_VI_VSYI_offset(image_scaling->crop_pos.win_y) | NPP_VI_VSYI_phase(0), NPP_MODE_reg);

		v_offset_c = (isYUV420)
		 ? (image_scaling->crop_pos.win_y / 2) : image_scaling->crop_pos.win_y;
		v_phase_c = 0;
		_WriteReg32(reg_NPP_VI_VSCI,
		 NPP_VI_VSCI_offset(v_offset_c) | NPP_VI_VSCI_phase(v_phase_c), NPP_MODE_reg);
	} else {
		_WriteReg32(reg_NPP_VI_VSYI, 0, NPP_MODE_reg);
		_WriteReg32(reg_NPP_VI_VSCI, 0, NPP_MODE_reg);
	}

	if (image_scaling->crop_pos.win_x != 0)
		_WriteReg32(reg_NPP_VI_HSI,
	     NPP_VI_HSI_offset(image_scaling->crop_pos.win_x) | NPP_VI_HSI_phase(0), NPP_MODE_reg);
	else
		_WriteReg32(reg_NPP_VI_HSI, 0, NPP_MODE_reg);

	vsd_delta = (image_scaling->crop_pos.win_h) ?
				CEIL((image_scaling->crop_pos.win_h * 0x10000),
				(image_scaling->output_height-1))
				: CEIL((image_scaling->input_height * 0x10000),
				(image_scaling->output_height-1));

	hsd_delta = (image_scaling->crop_pos.win_w) ?
				CEIL((image_scaling->crop_pos.win_w * 0x10000),
				(image_scaling->output_width-1))
				: CEIL((image_scaling->input_width * 0x10000),
				(image_scaling->output_width-1));

	_WriteReg32(reg_NPP_VI_HSD_W, NPP_VI_HSD_W_out(image_scaling->output_width), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_VSD_H, NPP_VI_VSD_H_out(image_scaling->output_height), NPP_MODE_reg);

	_WriteReg32(reg_NPP_VI_VSD, NPP_VI_VSD_delta(vsd_delta), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_HSD, NPP_VI_HSD_delta(hsd_delta), NPP_MODE_reg);

	vi_scaler_config_reset = NPP_VI_vhs_order_mask |
							 NPP_VI_vs_mask        |
							 NPP_VI_hs_mask;
	_WriteReg32(NPP_VI_reg, vi_scaler_config_reset | NPP_VI_write_data(0), NPP_MODE_reg);

	vi_scaler_config_set |= (image_scaling->input_width > 1920) ? NPP_VI_vhs_order_mask : 0;

	if (image_scaling->crop_pos.win_x != 0 || image_scaling->crop_pos.win_y != 0
	 || image_scaling->crop_pos.win_w != 0 || image_scaling->crop_pos.win_h != 0) {
		vi_scaler_config_set |= (hsd_delta == 0x10000) ? 0 : NPP_VI_hs_mask;
		vi_scaler_config_set |= (vsd_delta == 0x10000) ? 0 : NPP_VI_vs_mask;
	} else {
		if (image_scaling->output_width != image_scaling->input_width)
			vi_scaler_config_set |= (hsd_delta == 0x10000) ? 0 : NPP_VI_hs_mask;
		if (image_scaling->output_height != image_scaling->input_height)
			vi_scaler_config_set |= (vsd_delta == 0x10000) ? 0 : NPP_VI_vs_mask;
	}

	if (vi_scaler_config_set != 0)
		_WriteReg32(NPP_VI_reg, vi_scaler_config_set | NPP_VI_write_data(1), NPP_MODE_reg);

	if (!(pre_npp_hs_delta == hsd_delta && pre_npp_vs_delta == vsd_delta)) {
		unsigned char idx = 0;
		unsigned int reg_addr = 0;

		vsyi_phase = NPP_VI_VSYI_get_phase(image_scaling->crop_pos.win_y);
		vsci_phase = (isYUV420) ?
		(NPP_VI_VSCI_get_phase(image_scaling->crop_pos.win_y) / 2)
		: NPP_VI_VSCI_get_phase(image_scaling->crop_pos.win_y);

		_SetVideoScalingCoeffs16p((unsigned short *)npp_vi_vsyc,
		 vsd_delta, vsyi_phase, 4, 1, vi_st, 0);
		_SetVideoScalingCoeffs16p((unsigned short *)npp_vi_vscc,
		 vsd_delta >> isYUV420, vsci_phase, 4, 1, vi_st, 0);

		for (idx = 0; idx < 16; idx++) {
			reg_addr = reg_NPP_VI_VSYC_0 + (idx * 4);
			_WriteReg32(reg_addr, (npp_vi_vsyc[idx].c1 << 16) | npp_vi_vsyc[idx].c0, NPP_MODE_reg);
		}
		for (idx = 0; idx < 16; idx++) {
			reg_addr = reg_NPP_VI_VSCC_0 + (idx * 4);
			_WriteReg32(reg_addr, (npp_vi_vscc[idx].c1 << 16) | npp_vi_vscc[idx].c0, NPP_MODE_reg);
		}

		pre_npp_vs_delta = vsd_delta;
	}

	if (((vi_scaler_config_set & NPP_VI_hs_mask) != 0) && pre_npp_hs_delta != hsd_delta) {
		unsigned char idx = 0;
		unsigned int reg_addr = 0;

		hsi_phase = NPP_VI_HSI_get_phase(image_scaling->crop_pos.win_x);

		_SetVideoScalingCoeffs16p((unsigned short *)npp_vi_hsyc, hsd_delta,
		 hsi_phase, 8, 1, 0, 0);
		_SetVideoScalingCoeffs16p((unsigned short *)npp_vi_hscc, hsd_delta,
		 hsi_phase, 4, 1, 0, 0);

		for (idx = 0; idx < 32; idx++) {
			reg_addr = reg_NPP_VI_HSYC_0 + (idx * 4);
			_WriteReg32(reg_addr, (npp_vi_hsyc[idx].c1 << 16) | npp_vi_hsyc[idx].c0, NPP_MODE_reg);
		}
		for (idx = 0; idx < 16; idx++) {
			reg_addr = reg_NPP_VI_HSCC_0 + (idx * 4);
			_WriteReg32(reg_addr, (npp_vi_hscc[idx].c1 << 16) | npp_vi_hscc[idx].c0, NPP_MODE_reg);
		}

		pre_npp_hs_delta = hsd_delta;
	}

	pr_info("[NPP] VI_VSYI(0x%x)  = 0x%x, VI_VSCI(0x%x)  = 0x%x, VI_HSI(0x%x) = 0x%x\n",
	 reg_NPP_VI_VSYI, _ReadReg32(reg_NPP_VI_VSYI, NPP_MODE_reg), reg_NPP_VI_VSCI,
	 _ReadReg32(reg_NPP_VI_VSCI, NPP_MODE_reg), reg_NPP_VI_HSI, _ReadReg32(reg_NPP_VI_HSI, NPP_MODE_reg));
	pr_info("[NPP] VI_HSD_W(0x%x) = 0x%x, VI_VSD_H(0x%x) = 0x%x\n",
	reg_NPP_VI_HSD_W, _ReadReg32(reg_NPP_VI_HSD_W, NPP_MODE_reg), reg_NPP_VI_VSD_H,
	_ReadReg32(reg_NPP_VI_VSD_H, NPP_MODE_reg));
	pr_info("[NPP] VI_VSD(0x%x)   = 0x%x, VI_HSD(0x%x)   = 0x%x\n",
	 reg_NPP_VI_VSD, _ReadReg32(reg_NPP_VI_VSD, NPP_MODE_reg), reg_NPP_VI_HSD, _ReadReg32(reg_NPP_VI_HSD, NPP_MODE_reg));
	pr_info("[NPP] VI(0x%x)       = 0x%x\n",
	 NPP_VI_reg, _ReadReg32(NPP_VI_reg, NPP_MODE_reg));
	return NPP_STATUS_OK;
}

/*
 * Func : NPP_Set_EngineGo
 *
 * Desc : set NPP engine start operation
 *
 * Parm : target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Set_EngineGo(enum TARGET_SOC target_soc)
{
	_NPP_Set_EngineGo(target_soc);
}

/*
 * Func : NPP_Close_INTEN
 *
 * Desc : close NPP interrupt
 *
 * Parm : target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Close_INTEN(enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int NPP_INTEN_reg = regs->NPP_INTEN;

	_WriteReg32(NPP_INTEN_reg, NPP_INTEN_fin(1, target_soc) | NPP_INTEN_write_data(0), NPP_MODE_reg);
}

/*
 * Func : NPP_Clear_INTStatus
 *
 * Desc : clear NPP engine status
 *
 * Parm : int_mask[in]: interrupt mask that wants to clear
 *            target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Clear_INTStatus(unsigned int int_mask, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int NPP_INTST_reg = regs->NPP_INTST;

	if (int_mask == NPP_INTST_fin_mask)
		_WriteReg32(NPP_INTST_reg, NPP_INTST_fin(1) | NPP_INTST_write_data(0), NPP_MODE_reg);

	if (int_mask == NPP_INTST_vi_tvve_core_mask)
		_WriteReg32(NPP_INTST_reg, NPP_INTST_vi_tvve_core(1) | NPP_INTST_write_data(0), NPP_MODE_reg);
}

/*
 * Func : NPP_Get_INTStatus
 *
 * Desc : get NPP interrput status
 *
 * Parm : int_status[out]: interrupt status
 *            target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Get_INTStatus(unsigned int *int_status, enum TARGET_SOC target_soc)
{
	unsigned int intst = 0;
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int NPP_INTST_reg = regs->NPP_INTST;

	intst = _ReadReg32(NPP_INTST_reg, NPP_MODE_reg);
	pr_info("[NPP] get intst = 0x%x\n", intst);
	*int_status = intst & 0x06;
}

/*
 * Func : NPP_GetFinishStatus
 *
 * Desc : get NPP finish status after NPP go
 *
 * Parm : is_finish[out]: finish status
 *            target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Get_FinishStatus(unsigned char *is_finish, enum TARGET_SOC target_soc)
{
	_NPP_Get_INTStatus(is_finish, target_soc);
}

/*
 * Func : NPP_Get_RegInfo
 *
 * Desc : get NPP base register address and register range for
 * kernel ioremap_nocache() to map register.
 *
 * Parm : base_reg_addr[out]: NPP register base address
 *            reg_addr_range[out]: NPP register address range
 *            target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Get_RegInfo(unsigned int *base_reg_addr, unsigned int *reg_addr_range, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	*base_reg_addr = regs->NPP_MODE;
	*reg_addr_range = (regs->NPP_SRAM_RM - regs->NPP_MODE) + 4;
}

/*
 * Func : NPP_Set_MIPICSI_ImageFormat
 *
 * Desc : set NPP MIPI CSI image format
 *
 * Parm : mipi_csi_image_param[in]: MIPI CSI image format parameters
 *			target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Set_MIPICSI_ImageFormat(struct Npp_MIPICSI_ImageFormat *mipi_csi_image_param, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_VI_TVVE = regs->NPP_VI_TVVE;
	unsigned int reg_NPP_VI_TVVE_CROP = regs->NPP_VI_TVVE_CROP;
	unsigned int reg_NPP_VI_TVVE_CROP_POS = regs->NPP_VI_TVVE_CROP_POS;
	unsigned int reg_NPP_VI_TVVE_HEAD = regs->NPP_VI_TVVE_HEAD;
	unsigned int reg_NPP_VI_TVVE_DATA = regs->NPP_VI_TVVE_DATA;

	_WriteReg32(reg_NPP_VI_TVVE_CROP, 0x0, NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_TVVE_CROP_POS, 0x0, NPP_MODE_reg);

	_WriteReg32(reg_NPP_VI_TVVE,
	(_ReadReg32(reg_NPP_VI_TVVE, NPP_MODE_reg)
	& ~(NPP_VI_TVVE_qlevel_queue_sel_y_mask | NPP_VI_TVVE_qlevel_queue_sel_c_mask))
	| (NPP_VI_TVVE_qlevel_queue_sel_y(mipi_csi_image_param->qlevel_queue_sel_y)
	| NPP_VI_TVVE_qlevel_queue_sel_c(mipi_csi_image_param->qlevel_queue_sel_c)), NPP_MODE_reg);

	_WriteReg32(reg_NPP_VI_TVVE_HEAD,
	(_ReadReg32(reg_NPP_VI_TVVE_HEAD, NPP_MODE_reg)
	& ~(NPP_VI_TVVE_HEAD_endian_mask |
	NPP_VI_TVVE_HEAD_endian_4byte_mask |
	NPP_VI_TVVE_HEAD_pitch_mask))
	| NPP_VI_TVVE_HEAD_pitch(mipi_csi_image_param->header_pitch), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_TVVE_DATA,
	(_ReadReg32(reg_NPP_VI_TVVE_DATA, NPP_MODE_reg) & ~(NPP_VI_TVVE_DATA_endian_mask
	| NPP_VI_TVVE_DATA_blk_pitch_mask | NPP_VI_TVVE_DATA_pitch_mask))
	|(NPP_VI_TVVE_DATA_blk_pitch(mipi_csi_image_param->data_pitch/4)
	|NPP_VI_TVVE_DATA_pitch(mipi_csi_image_param->data_pitch/4)), NPP_MODE_reg);

	_WriteReg32(reg_NPP_VI_TVVE_CROP,
	NPP_VI_TVVE_CROP_width(mipi_csi_image_param->width)
	|NPP_VI_TVVE_CROP_height(mipi_csi_image_param->height), NPP_MODE_reg);

	pr_info("[NPP] VI_TVVE(0x%x) = 0x%x\n",
	reg_NPP_VI_TVVE, _ReadReg32(reg_NPP_VI_TVVE, NPP_MODE_reg));
	pr_info("[NPP] TVVE_HEAD(0x%x) = 0x%x, TVVE_DATA(0x%x) = 0x%x\n",
	reg_NPP_VI_TVVE_HEAD, _ReadReg32(reg_NPP_VI_TVVE_HEAD, NPP_MODE_reg),
	reg_NPP_VI_TVVE_DATA, _ReadReg32(reg_NPP_VI_TVVE_DATA, NPP_MODE_reg));
	pr_info("[NPP] TVVE_CROP(0x%x) = 0x%x, TVVE_CROP_POS(0x%x) = 0x%x\n",
	reg_NPP_VI_TVVE_CROP, _ReadReg32(reg_NPP_VI_TVVE_CROP, NPP_MODE_reg),
	reg_NPP_VI_TVVE_CROP_POS, _ReadReg32(reg_NPP_VI_TVVE_CROP_POS, NPP_MODE_reg));
}

/*
 * Func : NPP_Set_MIPICSI_CropWindow
 *
 * Desc : set NPP MIPI CSI input image crop window
 *
 * Parm : crop_x[in]: x direction offset
 *            crop_y[in]: y direction offset
 *            crop_width[in]: crop width
 *            crop_height[in]: crop height
 *            target_soc: SOC board
 * Retn : N/A
 */
void NPP_Set_MIPICSI_CropWindow(unsigned int crop_x, unsigned int crop_y,
unsigned int crop_width, unsigned int crop_height, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_VI_TVVE_CROP = regs->NPP_VI_TVVE_CROP;
	unsigned int reg_NPP_VI_TVVE_CROP_POS = regs->NPP_VI_TVVE_CROP_POS;

	_WriteReg32(reg_NPP_VI_TVVE_CROP, 0x0, NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_TVVE_CROP_POS, 0x0, NPP_MODE_reg);

	_WriteReg32(reg_NPP_VI_TVVE_CROP,
	 NPP_VI_TVVE_CROP_width(crop_width) | NPP_VI_TVVE_CROP_height(crop_height), NPP_MODE_reg);
	_WriteReg32(reg_NPP_VI_TVVE_CROP_POS,
	 NPP_VI_TVVE_CROP_POS_x(crop_x) | NPP_VI_TVVE_CROP_POS_y(crop_y), NPP_MODE_reg);

	pr_info("[NPP] TVVE_CROP(0x%x) = 0x%x, TVVE_CROP_POS(0x%x) = 0x%x\n",
	 reg_NPP_VI_TVVE_CROP, _ReadReg32(reg_NPP_VI_TVVE_CROP, NPP_MODE_reg),
	 reg_NPP_VI_TVVE_CROP_POS, _ReadReg32(reg_NPP_VI_TVVE_CROP_POS, NPP_MODE_reg));
}

/*
 * Func : NPP_Set_MIPICSI_InputDataBuffer
 *
 * Desc : set NPP MIPI CSI input buffer address
 *
 * Parm : mipi_csi_input_buf[in]: MIPI CSI input buffer parameters
 *            target_soc: SOC board
 * Retn : N/A
 */
void NPP_Set_MIPICSI_InputDataBuffer(struct Npp_MIPI_CSI_InputBufInfo *mipi_csi_input_buf, enum TARGET_SOC target_soc)
{
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_VI_TVVE_HEAD_LU = regs->NPP_VI_TVVE_HEAD_LU;
	unsigned int reg_NPP_VI_TVVE_HEAD_CH = regs->NPP_VI_TVVE_HEAD_CH;
	unsigned int reg_NPP_VI_TVVE_DATA_LU = regs->NPP_VI_TVVE_DATA_LU;
	unsigned int reg_NPP_VI_TVVE_DATA_CH = regs->NPP_VI_TVVE_DATA_CH;


	if (target_soc == STARK) {
		_WriteReg32(reg_NPP_VI_TVVE_HEAD_LU,
		 NPP_VI_TVVE_HEAD_LU_str_addr(mipi_csi_input_buf->y_header_addr), NPP_MODE_reg);
		_WriteReg32(reg_NPP_VI_TVVE_HEAD_CH,
		 NPP_VI_TVVE_HEAD_CH_str_addr(mipi_csi_input_buf->c_header_addr), NPP_MODE_reg);
		_WriteReg32(reg_NPP_VI_TVVE_DATA_LU,
		 NPP_VI_TVVE_DATA_LU_str_addr(mipi_csi_input_buf->y_data_addr), NPP_MODE_reg);
		_WriteReg32(reg_NPP_VI_TVVE_DATA_CH,
		 NPP_VI_TVVE_DATA_CH_str_addr(mipi_csi_input_buf->c_data_addr), NPP_MODE_reg);
	} else {
		_WriteReg32(reg_NPP_VI_TVVE_HEAD_LU,
		 NPP_VI_TVVE_HEAD_LU_str_addr((mipi_csi_input_buf->y_header_addr >> 4)), NPP_MODE_reg);
		_WriteReg32(reg_NPP_VI_TVVE_HEAD_CH,
		 NPP_VI_TVVE_HEAD_CH_str_addr((mipi_csi_input_buf->c_header_addr >> 4)), NPP_MODE_reg);
		_WriteReg32(reg_NPP_VI_TVVE_DATA_LU,
		 NPP_VI_TVVE_DATA_LU_str_addr((mipi_csi_input_buf->y_data_addr >> 4)), NPP_MODE_reg);
		_WriteReg32(reg_NPP_VI_TVVE_DATA_CH,
		 NPP_VI_TVVE_DATA_CH_str_addr((mipi_csi_input_buf->c_data_addr >> 4)), NPP_MODE_reg);
	}

	pr_info("[NPP] TVVE_HEAD_LU(0x%x) = 0x%x, TVVE_HEAD_CH(0x%x) = 0x%x\n",
	 reg_NPP_VI_TVVE_HEAD_LU, _ReadReg32(reg_NPP_VI_TVVE_HEAD_LU, NPP_MODE_reg),
	 reg_NPP_VI_TVVE_HEAD_CH, _ReadReg32(reg_NPP_VI_TVVE_HEAD_CH, NPP_MODE_reg));
	pr_info("[NPP] TVVE_DATA_LU(0x%x) = 0x%x, TVVE_DATA_CH(0x%x) = 0x%x\n",
	 reg_NPP_VI_TVVE_DATA_LU, _ReadReg32(reg_NPP_VI_TVVE_DATA_LU, NPP_MODE_reg),
	 reg_NPP_VI_TVVE_DATA_CH, _ReadReg32(reg_NPP_VI_TVVE_DATA_CH, NPP_MODE_reg));
}

/*
 * Func : NPP_Set_SecureVideoPath
 *
 * Desc : set NPP secure video path
 *
 * Parm : enable_svp[in]: 0 : normal mode  => read : non-secure buffer
 *                                            write : non-secure buffer
 *                                            1: protect mode  => read : non-secure / secure buffer
 *                                            write : secure buffer
 *                                            target_soc: SOC board
 *
 * Retn : N/A
 */
void NPP_Set_SecureVideoPath(unsigned char enable_svp, enum TARGET_SOC target_soc)
{
	unsigned char protect_mode = 0;
	const struct RegisterAddresses *regs = get_register_addresses(target_soc);
	unsigned int NPP_MODE_reg = regs->NPP_MODE;
	unsigned int reg_NPP_DMA_PRT_MODE = regs->NPP_DMA_PRT_MODE;

	protect_mode = (enable_svp == 0) ? DMA_NORMAL_MODE : DMA_PROTECT_MODE;
	_WriteReg32(reg_NPP_DMA_PRT_MODE, NPP_DMA_PRT_MODE_mb(protect_mode), NPP_MODE_reg);

	pr_info("[NPP] enable_svp = %d, NPP_DMA_PRT_MODE(0x%x) = 0x%x\n",
	 enable_svp, reg_NPP_DMA_PRT_MODE, _ReadReg32(reg_NPP_DMA_PRT_MODE, NPP_MODE_reg));
}
