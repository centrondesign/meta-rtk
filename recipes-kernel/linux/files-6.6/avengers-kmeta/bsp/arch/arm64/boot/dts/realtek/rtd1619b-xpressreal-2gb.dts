// SPDX-License-Identifier: (GPL-2.0-or-later OR BSD-2-Clause)
/*
 * Copyright (c) 2020 Realtek Semiconductor Corp.
 */

#include "rtd1619b-backinblack-2gb.dts"
#include <dt-bindings/regulator/anpec,apw888x.h>

/ {
	compatible = "realtek,xpressreal", "realtek,rtd1619b";
	model = "Realtek XpressReal (2GB)";

	vcc_ddr: vcc1v2-ddr {
		compatible = "regulator-fixed";
		regulator-name = "vcc1v2-ddr";
		regulator-min-microvolt = <1200000>;
		regulator-max-microvolt = <1200000>;
	};
};

&hdmi {
	hdmi5v-gpios = <&gpio 5 GPIO_ACTIVE_HIGH>;
};


&nic {
	status = "okay";
};

&pcie2 {
	status = "okay";
};

&pcie2_phy {
	status = "okay";
};

&rfkill {
	rfkill-gpios = <&gpio 57 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

&sdio {
	wifi-rst-gpios = <&gpio 61 GPIO_ACTIVE_HIGH>;
};

&usb_port0 {
        realtek,power-gpio = <&gpio 48 GPIO_ACTIVE_HIGH>;
        status = "okay";
};

&usb_port1_usb2phy {
        status = "okay";
};

&usb_port1 {
        realtek,power-gpio = <&gpio 48 GPIO_ACTIVE_HIGH>;
        status = "okay";
};

&usb_port2_usb2phy {
        status = "okay";
};

&usb_port2_usb3phy {
        status = "okay";
};

&usb_port2 {
        realtek,power-gpio = <&gpio 49 GPIO_ACTIVE_HIGH>;
        status = "okay";
};

&usb_manager {
	type_c: type-c@7220 {
		compatible= "realtek,rtd1619b-type-c";
		reg = <0x7220 0x20>;
		#address-cells = <1>;
		#size-cells = <1>;
		ranges;

		interrupts = <0 60 IRQ_TYPE_LEVEL_HIGH>;

		realtek,usb-port = <&usb_port2>;

		pinctrl-names = "default";
		pinctrl-0 = <&usb_cc1_pins>, <&usb_cc2_pins>;

		nvmem-cells = <&otp_usb_cal>;
		nvmem-cell-names = "usb-cal";

		resets = <&ic RTD1619B_ISO_RSTN_TYPE_C>; /* rstn_type_c */
		reset-names = "type-c"; /* rstn_type_c */

		/* For 1619B, u3drd */
		realtek,plug-side-switch-gpio = <&gpio 53 GPIO_ACTIVE_HIGH>;

		status = "okay";

		connector {
			compatible = "usb-c-connector";
			label = "USB-C";
			data-role = "dual";
			power-role = "dual";
		};
	};
};

/delete-node/ &cpu_supp;

&i2c_0 {
	clock-frequency = <3400000>;
	pinctrl-0 = <&i2c_pins_0_HS>;
	status = "okay";

	apw7899: apw7899@12 {
		compatible = "anpec,apw7899";
		reg = <0x12>;

		regulators {
			compatible = "anpec,apw8886-regulator";

			vd33_supp: dc1 {
				regulator-name = "vd33";
				regulator-min-microvolt = <2200000>;
				regulator-max-microvolt = <3777500>;

				regulator-boot-on;
				regulator-always-on;
				regulator-initial-mode = <APW888X_DC_MODE_AUTO>;
				regulator-state-mem {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
			};

			core_supp: dc2 {
				regulator-name = "core";
				regulator-min-microvolt = <550000>;
				regulator-max-microvolt = <1337500>;

				regulator-boot-on;
				regulator-always-on;
				regulator-initial-mode = <APW888X_DC_MODE_AUTO>;
				regulator-state-mem {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <800000>;
				};
			};

			cpu_supp_alt: dc3 {
				regulator-name = "cpudvs";
				regulator-min-microvolt = <550000>;
				regulator-max-microvolt = <1337500>;

				regulator-boot-on;
				regulator-always-on;
				regulator-initial-mode = <APW888X_DC_MODE_AUTO>;
				regulator-ramp-delay = <625>;
				apw888x-disabled-in-shutdown;

				regulator-state-mem {
					regulator-off-in-suspend;
					regulator-changeable-in-suspend;
				};
			};

			vd18_supp: dc4 {
				regulator-name = "vd18";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <2060000>;

				regulator-boot-on;
				regulator-always-on;
				regulator-initial-mode = <APW888X_DC_MODE_AUTO>;
				regulator-state-mem {
					regulator-on-in-suspend;
				};
			};

			ddr_supp: dc5 {
				regulator-name = "ddr";
				regulator-boot-on;
				regulator-always-on;
				regulator-initial-mode = <APW888X_DC_MODE_AUTO>;
				vin-supply = <&vcc_ddr>;
				apw888x-disabled-in-shutdown;

				regulator-state-mem {
					regulator-on-in-suspend;
				};
			};

			vd25_supp: ldo1 {
				regulator-name = "vd25";
				regulator-min-microvolt = <1780000>;
				regulator-max-microvolt = <3020000>;

				regulator-boot-on;
				regulator-always-on;
				regulator-initial-mode = <APW888X_LDO_MODE_NORMAL>;
				regulator-state-mem {
					regulator-on-in-suspend;
				};
			};

			vfb5 {
				regulator-name = "vfb5";
				regulator-min-microvolt = <512500>;
				regulator-max-microvolt = <700000>;

				regulator-boot-on;
				regulator-always-on;
				regulator-state-mem {
					regulator-on-in-suspend;
				};
			};
		};
	};
};

&cpu0 {
	cpu-supply = <&cpu_supp_alt>;
};

&cpu1 {
	cpu-supply = <&cpu_supp_alt>;
};

&cpu2 {
	cpu-supply = <&cpu_supp_alt>;
};

&cpu3 {
	cpu-supply = <&cpu_supp_alt>;
};

&pm_hifi {
        hifi-supply = <&cpu_supp_alt>;
};
